<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Payment Manager - Vakamova</title>
    <style>
        /* ØªÙ…Ø§Ù… Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .badge {
            background: #10b981;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 30px;
        }
        
        .test-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
            border-color: #4f46e5;
            box-shadow: 0 15px 40px rgba(79, 70, 229, 0.15);
        }
        
        .test-card.passed {
            border-left: 5px solid #10b981;
        }
        
        .test-card.failed {
            border-left: 5px solid #ef4444;
        }
        
        .test-card.pending {
            border-left: 5px solid #f59e0b;
        }
        
        .test-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #1f2937;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-result {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        
        .passed .test-result {
            background: #d1fae5;
            color: #065f46;
        }
        
        .failed .test-result {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .pending .test-result {
            background: #fef3c7;
            color: #92400e;
        }
        
        .test-desc {
            color: #6b7280;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        
        .test-output {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            direction: ltr;
        }
        
        .test-output.success {
            background: #f0fdf4;
            border-color: #bbf7d0;
        }
        
        .test-output.error {
            background: #fef2f2;
            border-color: #fecaca;
        }
        
        .test-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: #f8fafc;
            border-top: 2px solid #e2e8f0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            min-width: 120px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .passed .stat-value { color: #10b981; }
        .failed .stat-value { color: #ef4444; }
        .pending .stat-value { color: #f59e0b; }
        
        button {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .action-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 30px;
            border-top: 2px solid #e2e8f0;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
                padding: 20px;
            }
            
            header h1 {
                font-size: 1.8rem;
                flex-direction: column;
                gap: 10px;
            }
            
            .test-stats {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stat {
                flex-direction: row;
                justify-content: space-between;
            }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e2e8f0;
            border-top-color: #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        #status-bar {
            background: #f8fafc;
            padding: 10px 30px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        #console-log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            margin: 0 30px 30px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 150px;
            overflow-y: auto;
            direction: ltr;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span>ğŸ§ª ØªØ³Øª Payment Manager</span>
                <span class="badge">Vakamova</span>
            </h1>
            <p>ØªØ³Øª Ú©Ø§Ù…Ù„ Ù…Ø§Ú˜ÙˆÙ„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ Ø§ØµÙˆÙ„ SOLID</p>
        </header>
        
        <div id="status-bar">
            <div id="current-status">Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§...</div>
            <div id="connection-status">ğŸŸ¢ Ø¢Ù†Ù„Ø§ÛŒÙ†</div>
        </div>
        
        <div class="test-stats">
            <div class="stat passed">
                <span class="stat-value" id="passed-count">0</span>
                <span class="stat-label">Ù…ÙˆÙÙ‚</span>
            </div>
            <div class="stat failed">
                <span class="stat-value" id="failed-count">0</span>
                <span class="stat-label">Ù†Ø§Ù…ÙˆÙÙ‚</span>
            </div>
            <div class="stat pending">
                <span class="stat-value" id="pending-count">0</span>
                <span class="stat-label">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="coverage">0%</span>
                <span class="stat-label">Ù¾ÙˆØ´Ø´ ØªØ³Øª</span>
            </div>
        </div>
        
        <div class="test-grid" id="test-grid">
            <!-- ØªØ³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
        
        <div id="console-log">
            <div>> Ú©Ù†Ø³ÙˆÙ„ ØªØ³Øª:</div>
            <div id="console-output"></div>
        </div>
        
        <div class="action-bar">
            <button id="run-all-btn">
                <span>â–¶ï¸</span>
                Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
            <button id="clear-btn" style="background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%);">
                <span>ğŸ”„</span>
                Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬
            </button>
        </div>
    </div>

    <script>
        // ========== Ø¨Ø®Ø´ Û±: Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ ==========
        const logger = {
            log: (message, data = {}) => {
                const time = new Date().toLocaleTimeString('fa-IR');
                const output = document.getElementById('console-output');
                const logEntry = document.createElement('div');
                logEntry.innerHTML = `<span style="color: #94a3b8">[${time}]</span> ${message}`;
                output.appendChild(logEntry);
                output.scrollTop = output.scrollHeight;
                console.log(message, data);
            },
            error: (message, error) => {
                logger.log(`<span style="color: #ef4444">âŒ ${message}: ${error}</span>`);
            },
            success: (message) => {
                logger.log(`<span style="color: #10b981">âœ… ${message}</span>`);
            }
        };

        // ========== Ø¨Ø®Ø´ Û²: Mock EventBus ==========
        class MockEventBus {
            constructor() {
                this.events = new Map();
            }
            
            emit(event, data) {
                logger.log(`ğŸ“¡ Event: ${event}`, data);
            }
        }

        // ========== Ø¨Ø®Ø´ Û³: Mock Payment Adapter ==========
        class MockPaymentAdapter {
            async processPayment(request) {
                await new Promise(resolve => setTimeout(resolve, 300));
                return {
                    transactionId: `TXN_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    gatewayReference: `REF_${Math.random().toString(36).substr(2, 12)}`,
                    success: true
                };
            }
            
            async verifyPayment(transactionId) {
                await new Promise(resolve => setTimeout(resolve, 200));
                return {
                    success: true,
                    transactionId,
                    verificationCode: `VER_${Math.random().toString(36).substr(2, 8)}`
                };
            }
            
            async cancelPayment(transactionId) {
                await new Promise(resolve => setTimeout(resolve, 150));
                return {
                    success: true,
                    transactionId
                };
            }
            
            async isAvailable() {
                return true;
            }
        }

        // ========== Ø¨Ø®Ø´ Û´: Payment Manager ÙˆØ§Ù‚Ø¹ÛŒ ==========
        class PaymentManager {
            constructor(paymentAdapter, eventBus) {
                this._adapter = paymentAdapter;
                this._eventBus = eventBus;
                this._transactions = new Map();
                this._isProcessing = false;
            }
            
            async initiatePayment(request) {
                this._validatePaymentRequest(request);
                
                try {
                    this._isProcessing = true;
                    this._eventBus.emit('payment:initiated', {
                        requestId: request.id,
                        amount: request.amount
                    });
                    
                    const validatedRequest = await this._validateRequest(request);
                    const result = await this._adapter.processPayment(validatedRequest);
                    
                    this._transactions.set(request.id, {
                        ...result,
                        timestamp: Date.now(),
                        status: 'pending'
                    });
                    
                    this._eventBus.emit('payment:processed', {
                        requestId: request.id,
                        transactionId: result.transactionId
                    });
                    
                    return {
                        success: true,
                        transactionId: result.transactionId,
                        gatewayReference: result.gatewayReference,
                        timestamp: Date.now(),
                        nextSteps: ['verify_payment']
                    };
                    
                } catch (error) {
                    await this._handlePaymentError(error, request);
                    throw error;
                } finally {
                    this._isProcessing = false;
                }
            }
            
            async verifyPayment(transactionId) {
                try {
                    const result = await this._adapter.verifyPayment(transactionId);
                    
                    if (result.success && this._transactions.has(transactionId)) {
                        const transaction = this._transactions.get(transactionId);
                        transaction.status = 'completed';
                        transaction.verifiedAt = Date.now();
                        
                        this._eventBus.emit('payment:verified', {
                            transactionId,
                            amount: transaction.amount
                        });
                    }
                    
                    return result;
                    
                } catch (error) {
                    throw error;
                }
            }
            
            async cancelPayment(transactionId) {
                try {
                    const result = await this._adapter.cancelPayment(transactionId);
                    
                    if (this._transactions.has(transactionId)) {
                        this._transactions.delete(transactionId);
                    }
                    
                    this._eventBus.emit('payment:cancelled', { transactionId });
                    return result;
                    
                } catch (error) {
                    throw error;
                }
            }
            
            getTransactionStatus(transactionId) {
                if (!this._transactions.has(transactionId)) {
                    return null;
                }
                
                const transaction = this._transactions.get(transactionId);
                return {
                    id: transactionId,
                    status: transaction.status,
                    timestamp: transaction.timestamp
                };
            }
            
            async isAvailable() {
                return await this._adapter.isAvailable();
            }
            
            _validatePaymentRequest(request) {
                const errors = [];
                
                if (!request.id || typeof request.id !== 'string') {
                    errors.push('Invalid request ID');
                }
                
                if (!request.amount || request.amount <= 0) {
                    errors.push('Amount must be positive');
                }
                
                if (!request.currency || !['IRR', 'USD', 'EUR'].includes(request.currency)) {
                    errors.push('Invalid currency');
                }
                
                if (!request.userId || typeof request.userId !== 'string') {
                    errors.push('Invalid user ID');
                }
                
                if (errors.length > 0) {
                    throw new Error(`Payment request validation failed: ${errors.join(', ')}`);
                }
            }
            
            async _validateRequest(request) {
                const isAdapterAvailable = await this._adapter.isAvailable();
                if (!isAdapterAvailable) {
                    throw new Error('Payment service is unavailable');
                }
                
                return {
                    ...request,
                    validatedAt: Date.now()
                };
            }
            
            async _handlePaymentError(error, request) {
                this._eventBus.emit('payment:failed', {
                    requestId: request.id,
                    reason: error.message
                });
            }
            
            getStatistics() {
                const transactions = Array.from(this._transactions.values());
                return {
                    totalTransactions: transactions.length,
                    successful: transactions.filter(t => t.status === 'completed').length,
                    pending: transactions.filter(t => t.status === 'pending').length
                };
            }
        }

        // ========== Ø¨Ø®Ø´ Ûµ: ØªØ¹Ø±ÛŒÙ ØªØ³Øªâ€ŒÙ‡Ø§ ==========
        const tests = [
            {
                id: 'test-1',
                title: 'ØªØ³Øª Ø§ÛŒØ¬Ø§Ø¯ PaymentManager',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ ØµØ­ÛŒØ­ Ø´ÛŒ PaymentManager',
                run: async () => {
                    const eventBus = new MockEventBus();
                    const adapter = new MockPaymentAdapter();
                    const manager = new PaymentManager(adapter, eventBus);
                    
                    if (!manager._adapter) throw new Error('Adapter not set');
                    if (!manager._eventBus) throw new Error('EventBus not set');
                    
                    return 'âœ… PaymentManager Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯';
                }
            },
            {
                id: 'test-2',
                title: 'ØªØ³Øª Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ validation Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª',
                run: async () => {
                    const manager = new PaymentManager(
                        new MockPaymentAdapter(),
                        new MockEventBus()
                    );
                    
                    const validRequest = {
                        id: 'REQ_123',
                        amount: 50000,
                        currency: 'IRR',
                        userId: 'USER_001'
                    };
                    
                    manager._validatePaymentRequest(validRequest);
                    
                    const invalidRequest = {
                        id: '',
                        amount: 0,
                        currency: 'XYZ',
                        userId: ''
                    };
                    
                    try {
                        manager._validatePaymentRequest(invalidRequest);
                        throw new Error('Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯ Ø§Ù…Ø§ Ù†Ø¯Ø§Ø¯!');
                    } catch (e) {
                        // Ù…ÙˆÙÙ‚ÛŒØª: Ø®Ø·Ø§ Ú¯Ø±ÙØªÛŒÙ…
                    }
                    
                    return 'âœ… Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª ØµØ­ÛŒØ­ Ø§Ø³Øª';
                }
            },
            {
                id: 'test-3',
                title: 'ØªØ³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ ÙØ±Ø¢ÛŒÙ†Ø¯ Ú©Ø§Ù…Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª',
                run: async () => {
                    const manager = new PaymentManager(
                        new MockPaymentAdapter(),
                        new MockEventBus()
                    );
                    
                    const paymentRequest = {
                        id: `PAY_${Date.now()}`,
                        amount: 99000,
                        currency: 'IRR',
                        userId: 'USER_TEST_001'
                    };
                    
                    const result = await manager.initiatePayment(paymentRequest);
                    
                    if (!result.success) throw new Error('Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚ Ù†Ø¨ÙˆØ¯');
                    if (!result.transactionId) throw new Error('Ø´Ù†Ø§Ø³Ù‡ ØªØ±Ø§Ú©Ù†Ø´ ØªÙˆÙ„ÛŒØ¯ Ù†Ø´Ø¯');
                    
                    return `âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚. Ø´Ù†Ø§Ø³Ù‡: ${result.transactionId}`;
                }
            },
            {
                id: 'test-4',
                title: 'ØªØ³Øª ØªØ§ÛŒÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ ÙØ±Ø¢ÛŒÙ†Ø¯ ØªØ§ÛŒÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª',
                run: async () => {
                    const manager = new PaymentManager(
                        new MockPaymentAdapter(),
                        new MockEventBus()
                    );
                    
                    const paymentRequest = {
                        id: `PAY_VERIFY_${Date.now()}`,
                        amount: 149000,
                        currency: 'IRR',
                        userId: 'USER_TEST_002'
                    };
                    
                    const paymentResult = await manager.initiatePayment(paymentRequest);
                    const verificationResult = await manager.verifyPayment(paymentResult.transactionId);
                    
                    if (!verificationResult.success) throw new Error('ØªØ§ÛŒÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯');
                    
                    return `âœ… Ù¾Ø±Ø¯Ø§Ø®Øª ØªØ§ÛŒÛŒØ¯ Ø´Ø¯. Ú©Ø¯: ${verificationResult.verificationCode}`;
                }
            },
            {
                id: 'test-5',
                title: 'ØªØ³Øª Ù„ØºÙˆ Ù¾Ø±Ø¯Ø§Ø®Øª',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ ÙØ±Ø¢ÛŒÙ†Ø¯ Ù„ØºÙˆ Ù¾Ø±Ø¯Ø§Ø®Øª',
                run: async () => {
                    const manager = new PaymentManager(
                        new MockPaymentAdapter(),
                        new MockEventBus()
                    );
                    
                    const paymentRequest = {
                        id: `PAY_CANCEL_${Date.now()}`,
                        amount: 75000,
                        currency: 'IRR',
                        userId: 'USER_TEST_003'
                    };
                    
                    const paymentResult = await manager.initiatePayment(paymentRequest);
                    const cancelResult = await manager.cancelPayment(paymentResult.transactionId);
                    
                    if (!cancelResult.success) throw new Error('Ù„ØºÙˆ Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯');
                    
                    return 'âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù„ØºÙˆ Ø´Ø¯';
                }
            },
            {
                id: 'test-6',
                title: 'ØªØ³Øª Ø¢Ù…Ø§Ø± Ùˆ Ú¯Ø²Ø§Ø±Ø´',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ù…Ø§Ø± Ø¯Ù‚ÛŒÙ‚ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§',
                run: async () => {
                    const manager = new PaymentManager(
                        new MockPaymentAdapter(),
                        new MockEventBus()
                    );
                    
                    const requests = [
                        { id: `STAT_1_${Date.now()}`, amount: 50000, currency: 'IRR', userId: 'USER_1' },
                        { id: `STAT_2_${Date.now() + 1}`, amount: 100000, currency: 'IRR', userId: 'USER_2' }
                    ];
                    
                    for (const req of requests) {
                        await manager.initiatePayment(req);
                    }
                    
                    const stats = manager.getStatistics();
                    
                    if (stats.totalTransactions !== 2) {
                        throw new Error(`ØªØ¹Ø¯Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ ${stats.totalTransactions} Ø§Ø³Øª (Ø§Ù†ØªØ¸Ø§Ø±: 2)`);
                    }
                    
                    return `âœ… Ø¢Ù…Ø§Ø± ØµØ­ÛŒØ­ Ø§Ø³Øª. ØªØ¹Ø¯Ø§Ø¯: ${stats.totalTransactions}`;
                }
            }
        ];

        // ========== Ø¨Ø®Ø´ Û¶: Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª ØªØ³Øª ==========
        const TestManager = {
            tests: tests,
            results: {},
            
            renderTests() {
                const testGrid = document.getElementById('test-grid');
                testGrid.innerHTML = '';
                
                this.tests.forEach(test => {
                    const card = document.createElement('div');
                    card.className = 'test-card pending';
                    card.id = `card-${test.id}`;
                    card.innerHTML = `
                        <div class="test-title">
                            <span>${test.title}</span>
                            <span class="test-result" id="result-${test.id}">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
                        </div>
                        <div class="test-desc">${test.description}</div>
                        <div class="test-output" id="output-${test.id}"></div>
                    `;
                    testGrid.appendChild(card);
                });
                
                this.updateStats();
            },
            
            async runTest(test) {
                const card = document.getElementById(`card-${test.id}`);
                const output = document.getElementById(`output-${test.id}`);
                const resultSpan = document.getElementById(`result-${test.id}`);
                
                card.className = 'test-card pending';
                resultSpan.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
                output.className = 'test-output';
                output.innerHTML = '<div class="loading"></div> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...';
                
                document.getElementById('current-status').textContent = `Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª: ${test.title}`;
                
                try {
                    const result = await test.run();
                    card.className = 'test-card passed';
                    resultSpan.textContent = 'Ù…ÙˆÙÙ‚';
                    output.className = 'test-output success';
                    output.innerHTML = `<strong>âœ… Ù†ØªÛŒØ¬Ù‡:</strong> ${result}`;
                    this.results[test.id] = { success: true, result };
                    logger.success(`ØªØ³Øª "${test.title}" Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯`);
                    return true;
                } catch (error) {
                    card.className = 'test-card failed';
                    resultSpan.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                    output.className = 'test-output error';
                    output.innerHTML = `<strong>âŒ Ø®Ø·Ø§:</strong> ${error.message}`;
                    this.results[test.id] = { success: false, error: error.message };
                    logger.error(`ØªØ³Øª "${test.title}" Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯`, error.message);
                    return false;
                } finally {
                    this.updateStats();
                }
            },
            
            async runAllTests() {
                const runBtn = document.getElementById('run-all-btn');
                runBtn.disabled = true;
                runBtn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§...';
                
                let passed = 0;
                
                logger.log('ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§...');
                
                for (const test of this.tests) {
                    const success = await this.runTest(test);
                    if (success) passed++;
                    await new Promise(resolve => setTimeout(resolve, 500)); // ÙˆÙ‚ÙÙ‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ±
                }
                
                runBtn.disabled = false;
                runBtn.innerHTML = '<span>â–¶ï¸</span> Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¬Ø¯Ø¯ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§';
                document.getElementById('current-status').textContent = `ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯: ${passed} Ø§Ø² ${this.tests.length} ØªØ³Øª Ù…ÙˆÙÙ‚`;
                
                logger.log(`ğŸ¯ ØªØ³Øªâ€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯! ${passed} Ù…ÙˆÙÙ‚ Ø§Ø² ${this.tests.length} ØªØ³Øª`);
            },
            
            updateStats() {
                const passed = document.querySelectorAll('.test-card.passed').length;
                const failed = document.querySelectorAll('.test-card.failed').length;
                const pending = this.tests.length - passed - failed;
                
                document.getElementById('passed-count').textContent = passed;
                document.getElementById('failed-count').textContent = failed;
                document.getElementById('pending-count').textContent = pending;
                
                const coverage = Math.round((passed / this.tests.length) * 100);
                document.getElementById('coverage').textContent = `${coverage}%`;
            },
            
            clearTests() {
                this.tests.forEach(test => {
                    const card = document.getElementById(`card-${test.id}`);
                    const output = document.getElementById(`output-${test.id}`);
                    const resultSpan = document.getElementById(`result-${test.id}`);
                    
                    card.className = 'test-card pending';
                    resultSpan.textContent = 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
                    output.className = 'test-output';
                    output.innerHTML = '';
                });
                
                this.results = {};
                this.updateStats();
                document.getElementById('console-output').innerHTML = '';
                document.getElementById('current-status').textContent = 'Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§...';
                logger.log('ğŸ§¹ Ù†ØªØ§ÛŒØ¬ ØªØ³Øªâ€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯');
            }
        };

        // ========== Ø¨Ø®Ø´ Û·: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ==========
        document.addEventListener('DOMContentLoaded', () => {
            // Ø±Ù†Ø¯Ø± ØªØ³Øªâ€ŒÙ‡Ø§
            TestManager.renderTests();
            
            // Ø§ØªØµØ§Ù„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.getElementById('run-all-btn').addEventListener('click', () => {
                TestManager.runAllTests();
            });
            
            document.getElementById('clear-btn').addEventListener('click', () => {
                TestManager.clearTests();
            });
            
            // Ù„Ø§Ú¯ Ø´Ø±ÙˆØ¹
            logger.log('ğŸš€ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Payment Manager Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ Ù‡Ø³ØªÙ†Ø¯');
            logger.log('ğŸ“± Ø§ÛŒÙ† ØªØ³Øªâ€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù‚Ø§Ø¨Ù„ Ø§Ø¬Ø±Ø§ Ù‡Ø³ØªÙ†Ø¯');
            logger.log('ğŸ” Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±ØŒ Ú©Ù†Ø³ÙˆÙ„ Ù…Ø±ÙˆØ±Ú¯Ø± Ø±Ø§ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯ (F12)');
            
            // Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª
            document.getElementById('current-status').textContent = 'Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ - Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯';
        });

        // ========== Ø¨Ø®Ø´ Û¸: ØªÙˆØ§Ø¨Ø¹ global Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ HTML ==========
        window.runAllTests = () => TestManager.runAllTests();
        window.clearTests = () => TestManager.clearTests();
    </script>
</body>
</html>
