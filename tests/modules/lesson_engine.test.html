```html
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Lesson Engine - Ù¾Ø±ÙˆÚ˜Ù‡ Vakamova</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1, h2, h3 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
        }
        .test-case {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .success {
            color: #27ae60;
            font-weight: bold;
            padding: 8px;
            background: #d5f4e6;
            border-radius: 4px;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
            padding: 8px;
            background: #fadbd8;
            border-radius: 4px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #1abc9c);
            width: 0%;
            transition: width 0.5s ease;
        }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .event-log {
            background: #34495e;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .dependency-diagram {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .dependency-box {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px;
            min-width: 200px;
            text-align: center;
        }
        .test-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .lesson-visual {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ØªØ³Øª Lesson Engine - Ù¾Ø±ÙˆÚ˜Ù‡ Vakamova</h1>
        <p>ØªØ³Øª Ù…Ø§Ú˜ÙˆÙ„ Ù…ÙˆØªÙˆØ± Ø¢Ù…ÙˆØ²Ø´ - Ù‚Ù„Ø¨ Ø§ØµÙ„ÛŒ Ø³ÛŒØ³ØªÙ… Ø¢Ù…ÙˆØ²Ø´ÛŒ</p>
        
        <div class="test-stats">
            <div class="stat-box">
                <h3>Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ø´Ø¯Ù‡</h3>
                <p id="modules-tested">0/7</p>
            </div>
            <div class="stat-box">
                <h3>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚</h3>
                <p id="tests-passed">0</p>
            </div>
            <div class="stat-box">
                <h3>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚</h3>
                <p id="tests-failed">0</p>
            </div>
            <div class="stat-box">
                <h3>Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§</h3>
                <p id="execution-time">0 Ø«Ø§Ù†ÛŒÙ‡</p>
            </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        
        <div class="dependency-diagram">
            <div class="dependency-box">ğŸ“¦ Database</div>
            <div class="dependency-box">ğŸ”” Event Bus</div>
            <div class="dependency-box">ğŸ“Š Progress Tracker</div>
        </div>
        
        <div class="test-section">
            <h2>1. ØªØ³Øª Dependency Injection Ùˆ Ø³Ø§Ø®Øª Ù…ÙˆØªÙˆØ±</h2>
            <div class="test-case">
                <p><strong>ØªØ³Øª 1.1:</strong> Ø³Ø§Ø®Øª LessonEngine Ø¨Ø§ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø±</p>
                <button onclick="testConstruction()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="test1-result"></div>
            </div>
            <div class="test-case">
                <p><strong>ØªØ³Øª 1.2:</strong> Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø·Ø§ Ù‡Ù†Ú¯Ø§Ù… Ù†Ø¨ÙˆØ¯ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§</p>
                <button onclick="testConstructionError()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="test2-result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>2. ØªØ³Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯ÙˆØ±Ù‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ</h2>
            <div class="lesson-visual">
                <h3>ğŸ“š Ø¯ÙˆØ±Ù‡ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ: Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ</h3>
                <p>5 Ø¯Ø±Ø³ - 20 ØªÙ…Ø±ÛŒÙ† - 10 Ø³Ø§Ø¹Øª ØªØ®Ù…ÛŒÙ†ÛŒ</p>
            </div>
            <div class="test-case">
                <p><strong>ØªØ³Øª 2.1:</strong> Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯ÙˆØ±Ù‡ Ù…ÙˆÙÙ‚</p>
                <button onclick="testLoadCourse()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="test3-result"></div>
            </div>
            <div class="test-case">
                <p><strong>ØªØ³Øª 2.2:</strong> Ø®Ø·Ø§ÛŒ Ø¯ÙˆØ±Ù‡ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯</p>
                <button onclick="testLoadCourseError()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="test4-result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>3. ØªØ³Øª Ø´Ø±ÙˆØ¹ Ø¬Ù„Ø³Ù‡ Ø¯Ø±Ø³</h2>
            <div class="test-case">
                <p><strong>ØªØ³Øª 3.1:</strong> Ø´Ø±ÙˆØ¹ Ø¬Ù„Ø³Ù‡ Ø¬Ø¯ÛŒØ¯</p>
                <button onclick="testStartLesson()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="test5-result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>4. ØªØ³Øª Ø§Ø±Ø³Ø§Ù„ ØªÙ…Ø±ÛŒÙ† Ùˆ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ</h2>
            <div class="test-case">
                <p><strong>ØªØ³Øª 4.1:</strong> Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­</p>
                <button onclick="testSubmitExerciseCorrect()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="test6-result"></div>
            </div>
            <div class="test-case">
                <p><strong>ØªØ³Øª 4.2:</strong> Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª</p>
                <button onclick="testSubmitExerciseWrong()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="test7-result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>5. ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØª Ú©Ø§Ø±Ø¨Ø±</h2>
            <div class="test-case">
                <p><strong>ØªØ³Øª 5.1:</strong> Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ´Ø±ÙØª Ú©Ø§Ø±Ø¨Ø±</p>
                <button onclick="testGetProgress()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="test8-result"></div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>6. ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ - Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ú©Ø§Ù…Ù„</h2>
            <div class="test-case">
                <p><strong>ØªØ³Øª 6.1:</strong> Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±</p>
                <button onclick="testFullScenario()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ú©Ø§Ù…Ù„</button>
                <div id="test9-result"></div>
            </div>
        </div>
        
        <h2>ğŸ“‹ Ù„Ø§Ú¯ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§</h2>
        <div class="event-log" id="event-log">
            <!-- Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </h2>
        
        <h2>ğŸ“ Ù„Ø§Ú¯ Ø§Ø¬Ø±Ø§</h2>
        <div class="log" id="log">
            <!-- Ù†ØªØ§ÛŒØ¬ ØªØ³Øª Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="runAllTests()" style="background: linear-gradient(135deg, #2ecc71, #1abc9c); padding: 15px 40px; font-size: 18px;">
                â–¶ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
        </div>
    </div>

    <script type="module">
        // Ø§ÛŒÙ…Ù¾ÙˆØ±Øª Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù…
        import { LessonEngine, ILessonEngine } from '../../modules/lesson-engine/lesson-engine.js';
        import { EventBus } from '../../core/event-bus.js';
        
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ³Øª
        let lessonEngine;
        let testDatabase;
        let mockProgressTracker;
        let eventBus;
        let testResults = {
            passed: 0,
            failed: 0,
            total: 0
        };
        let startTime;
        
        // Ù„Ø§Ú¯ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
        const eventLog = document.getElementById('event-log');
        
        // ==================== Mock Dependencies ====================
        
        // Mock Database
        class MockDatabase {
            constructor() {
                this.courses = {
                    'english-beginner': {
                        id: 'english-beginner',
                        title: 'Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ',
                        description: 'Ø¯ÙˆØ±Ù‡ Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ',
                        language: 'en',
                        lessons: [
                            { id: 'lesson1', title: 'Ù…Ø¹Ø±ÙÛŒ Ùˆ Ø³Ù„Ø§Ù…', order: 1, difficulty: 'beginner', duration: 30 },
                            { id: 'lesson2', title: 'Ø§Ø¹Ø¯Ø§Ø¯ Ùˆ Ø´Ù…Ø§Ø±Ø´', order: 2, difficulty: 'beginner', duration: 45 }
                        ],
                        estimatedHours: 10,
                        exercises: [
                            { id: 'ex1', lessonId: 'lesson1', type: 'multiple-choice', question: 'How are you?', 
                              correctAnswers: ['I am fine'], points: 10 },
                            { id: 'ex2', lessonId: 'lesson1', type: 'translation', question: 'Ø³Ù„Ø§Ù…',
                              correctAnswers: ['Hello'], points: 15 }
                        ]
                    }
                };
                
                this.lessons = {
                    'lesson1': {
                        id: 'lesson1',
                        title: 'Ù…Ø¹Ø±ÙÛŒ Ùˆ Ø³Ù„Ø§Ù…',
                        courseId: 'english-beginner',
                        order: 1,
                        difficulty: 'beginner',
                        duration: 30,
                        exercises: ['ex1', 'ex2']
                    }
                };
                
                this.exercises = {
                    'ex1': {
                        id: 'ex1',
                        lessonId: 'lesson1',
                        type: 'multiple-choice',
                        question: 'How are you?',
                        correctAnswers: ['I am fine'],
                        points: 10
                    },
                    'ex2': {
                        id: 'ex2',
                        lessonId: 'lesson1',
                        type: 'translation',
                        question: 'Ø³Ù„Ø§Ù…',
                        correctAnswers: ['Hello'],
                        points: 15
                    }
                };
            }
            
            query(table) {
                return {
                    where: (field, operator, value) => {
                        return this.andWhere(field, operator, value);
                    },
                    andWhere: (field, operator, value) => {
                        // ÙÛŒÙ„ØªØ± Ø³Ø§Ø¯Ù‡
                        this._filterField = field;
                        this._filterValue = value;
                        return this;
                    },
                    with: (relation) => {
                        this._relation = relation;
                        return this;
                    },
                    first: async () => {
                        if (table === 'courses') {
                            const course = this.courses[this._filterValue];
                            if (course && this._relation === 'lessons') {
                                return { ...course, lessons: course.lessons };
                            }
                            return course;
                        } else if (table === 'lessons') {
                            const lesson = this.lessons[this._filterValue];
                            if (lesson && this._relation === 'exercises') {
                                return { ...lesson, exercises: lesson.exercises.map(id => this.exercises[id]) };
                            }
                            return lesson;
                        } else if (table === 'exercises') {
                            return this.exercises[this._filterValue];
                        }
                        return null;
                    }
                };
            }
        }
        
        // Mock Progress Tracker
        class MockProgressTracker {
            constructor() {
                this.sessions = [];
                this.userProgress = {};
            }
            
            async startSession(sessionId, userId, lessonId) {
                this.sessions.push({ sessionId, userId, lessonId, startTime: new Date() });
                return true;
            }
            
            async recordExerciseResult(data) {
                // Ø°Ø®ÛŒØ±Ù‡ Ù†ØªÛŒØ¬Ù‡ ØªÙ…Ø±ÛŒÙ†
                return true;
            }
            
            async completeLesson(userId, lessonId, score, startTime, endTime) {
                // ØªÚ©Ù…ÛŒÙ„ Ø¯Ø±Ø³
                if (!this.userProgress[userId]) {
                    this.userProgress[userId] = { completedLessons: 0, overallScore: 0, timeSpent: 0 };
                }
                this.userProgress[userId].completedLessons += 1;
                this.userProgress[userId].overallScore += score;
                this.userProgress[userId].timeSpent += (endTime - startTime) / 1000;
                this.userProgress[userId].lastActive = new Date();
                return true;
            }
            
            async getUserProgress(userId, courseId) {
                return this.userProgress[userId] || { 
                    completedLessons: 0, 
                    overallScore: 0, 
                    timeSpent: 0, 
                    lastActive: null 
                };
            }
        }
        
        // ==================== Helper Functions ====================
        
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#e74c3c' : 
                         type === 'success' ? '#27ae60' : 
                         type === 'warning' ? '#f39c12' : '#3498db';
            
            logElement.innerHTML += `<div style="color: ${color}; margin: 5px 0;">
                <span style="color: #7f8c8d;">[${time}]</span> ${message}
            </div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateStats() {
            document.getElementById('tests-passed').textContent = testResults.passed;
            document.getElementById('tests-failed').textContent = testResults.failed;
            document.getElementById('modules-tested').textContent = `7/7`;
            
            const totalTests = testResults.passed + testResults.failed;
            const progress = totalTests > 0 ? (testResults.passed / 9) * 100 : 0;
            document.getElementById('progress-fill').style.width = `${progress}%`;
            
            if (startTime) {
                const elapsed = (Date.now() - startTime) / 1000;
                document.getElementById('execution-time').textContent = `${elapsed.toFixed(2)} Ø«Ø§Ù†ÛŒÙ‡`;
            }
        }
        
        function recordResult(testNumber, success, message) {
            testResults.total++;
            const resultElement = document.getElementById(`test${testNumber}-result`);
            
            if (success) {
                testResults.passed++;
                resultElement.innerHTML = `<div class="success">âœ… Ù…ÙˆÙÙ‚: ${message}</div>`;
                log(`âœ… ØªØ³Øª ${testNumber} Ù…ÙˆÙÙ‚: ${message}`, 'success');
            } else {
                testResults.failed++;
                resultElement.innerHTML = `<div class="error">âŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${message}</div>`;
                log(`âŒ ØªØ³Øª ${testNumber} Ù†Ø§Ù…ÙˆÙÙ‚: ${message}`, 'error');
            }
            
            updateStats();
        }
        
        // ==================== Initialize ====================
        
        async function initialize() {
            log('ğŸ”§ Ø´Ø±ÙˆØ¹ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ØªØ³Øª Lesson Engine...', 'info');
            
            try {
                // Ø§ÛŒØ¬Ø§Ø¯ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
                eventBus = new EventBus();
                testDatabase = new MockDatabase();
                mockProgressTracker = new MockProgressTracker();
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
                eventBus.subscribe('lesson-engine.error', (data) => {
                    eventLog.innerHTML += `<div style="color: #e74c3c;">[ERROR] ${JSON.stringify(data)}</div>`;
                });
                
                eventBus.subscribe('lesson.started', (data) => {
                    eventLog.innerHTML += `<div style="color: #3498db;">[LESSON STARTED] Ú©Ø§Ø±Ø¨Ø± ${data.userId} Ø¯Ø±Ø³ ${data.lessonId}</div>`;
                });
                
                eventBus.subscribe('lesson.completed', (data) => {
                    eventLog.innerHTML += `<div style="color: #2ecc71;">[LESSON COMPLETED] Ú©Ø§Ø±Ø¨Ø± ${data.userId} Ù†Ù…Ø±Ù‡ ${data.score}</div>`;
                });
                
                // Ø³Ø§Ø®Øª Lesson Engine
                lessonEngine = new LessonEngine({
                    database: testDatabase,
                    eventBus: eventBus,
                    progressTracker: mockProgressTracker
                });
                
                log('âœ… Lesson Engine Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯', 'success');
                return true;
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ: ${error.message}`, 'error');
                return false;
            }
        }
        
        // ==================== Test Functions ====================
        
        async function testConstruction() {
            try {
                // Ø³Ø§Ø®Øª Ù…ÙˆØªÙˆØ± Ø¨Ø§ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø±
                const engine = new LessonEngine({
                    database: testDatabase,
                    eventBus: eventBus,
                    progressTracker: mockProgressTracker
                });
                
                if (engine && engine._database && engine._eventBus) {
                    recordResult(1, true, 'LessonEngine Ø¨Ø§ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø¹ØªØ¨Ø± Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯');
                } else {
                    recordResult(1, false, 'LessonEngine Ø³Ø§Ø®ØªÙ‡ Ù†Ø´Ø¯');
                }
            } catch (error) {
                recordResult(1, false, `Ø®Ø·Ø§: ${error.message}`);
            }
        }
        
        async function testConstructionError() {
            try {
                // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ù…ÙˆØªÙˆØ± Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ
                const engine = new LessonEngine({});
                recordResult(2, false, 'Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯ Ø§Ù…Ø§ Ù†Ø¯Ø§Ø¯');
            } catch (error) {
                if (error.message.includes('All dependencies are required')) {
                    recordResult(2, true, 'Ø®Ø·Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ù‡Ù†Ú¯Ø§Ù… Ù†Ø¨ÙˆØ¯ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§');
                } else {
                    recordResult(2, false, `Ø®Ø·Ø§ÛŒ Ù†Ø§Ø¯Ø±Ø³Øª: ${error.message}`);
                }
            }
        }
        
        async function testLoadCourse() {
            try {
                const course = await lessonEngine.loadCourse('english-beginner', 'en');
                
                if (course && course.id === 'english-beginner' && course.lessons.length === 2) {
                    recordResult(3, true, `Ø¯ÙˆØ±Ù‡ "${course.title}" Ø¨Ø§ ${course.totalLessons} Ø¯Ø±Ø³ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`);
                } else {
                    recordResult(3, false, 'Ø¯ÙˆØ±Ù‡ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯');
                }
            } catch (error) {
                recordResult(3, false, `Ø®Ø·Ø§: ${error.message}`);
            }
        }
        
        async function testLoadCourseError() {
            try {
                const course = await lessonEngine.loadCourse('non-existent', 'en');
                recordResult(4, false, 'Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯ Ø§Ù…Ø§ Ù†Ø¯Ø§Ø¯');
            } catch (error) {
                if (error.message.includes('not found')) {
                    recordResult(4, true, 'Ø®Ø·Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ±Ù‡ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯');
                } else {
                    recordResult(4, false, `Ø®Ø·Ø§ÛŒ Ù†Ø§Ø¯Ø±Ø³Øª: ${error.message}`);
                }
            }
        }
        
        async function testStartLesson() {
            try {
                const session = await lessonEngine.startLesson('lesson1', 'user123');
                
                if (session && session.id && session.lessonId === 'lesson1') {
                    recordResult(5, true, `Ø¬Ù„Ø³Ù‡ ${session.id} Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± user123 Ø´Ø±ÙˆØ¹ Ø´Ø¯`);
                } else {
                    recordResult(5, false, 'Ø¬Ù„Ø³Ù‡ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø´Ø±ÙˆØ¹ Ù†Ø´Ø¯');
                }
            } catch (error) {
                recordResult(5, false, `Ø®Ø·Ø§: ${error.message}`);
            }
        }
        
        async function testSubmitExerciseCorrect() {
            try {
                // Ø´Ø±ÙˆØ¹ Ø¬Ù„Ø³Ù‡
                const session = await lessonEngine.startLesson('lesson1', 'user123');
                
                // Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­
                const result = await lessonEngine.submitExercise({
                    sessionId: session.id,
                    exerciseId: 'ex1',
                    answers: ['I am fine'],
                    timeSpent: 30
                });
                
                if (result.isCorrect && result.score === 10) {
                    recordResult(6, true, `Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­ - Ù†Ù…Ø±Ù‡: ${result.score}`);
                } else {
                    recordResult(6, false, 'Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­ Ø§Ø´ØªØ¨Ø§Ù‡ Ø¨ÙˆØ¯');
                }
            } catch (error) {
                recordResult(6, false, `Ø®Ø·Ø§: ${error.message}`);
            }
        }
        
        async function testSubmitExerciseWrong() {
            try {
                // Ø´Ø±ÙˆØ¹ Ø¬Ù„Ø³Ù‡ Ø¬Ø¯ÛŒØ¯
                const session = await lessonEngine.startLesson('lesson1', 'user456');
                
                // Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª
                const result = await lessonEngine.submitExercise({
                    sessionId: session.id,
                    exerciseId: 'ex1',
                    answers: ['I am bad'], // Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª
                    timeSpent: 45
                });
                
                if (!result.isCorrect && result.score === 0) {
                    recordResult(7, true, `Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª - Ù†Ù…Ø±Ù‡: ${result.score}`);
                } else {
                    recordResult(7, false, 'Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø§Ø³Ø® Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø´ØªØ¨Ø§Ù‡ Ø¨ÙˆØ¯');
                }
            } catch (error) {
                recordResult(7, false, `Ø®Ø·Ø§: ${error.message}`);
            }
        }
        
        async function testGetProgress() {
            try {
                // ØªÚ©Ù…ÛŒÙ„ ÛŒÚ© Ø¯Ø±Ø³ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
                const session = await lessonEngine.startLesson('lesson1', 'user789');
                await lessonEngine.submitExercise({
                    sessionId: session.id,
                    exerciseId: 'ex1',
                    answers: ['I am fine'],
                    timeSpent: 30
                });
                await lessonEngine.submitExercise({
                    sessionId: session.id,
                    exerciseId: 'ex2',
                    answers: ['Hello'],
                    timeSpent: 40
                });
                
                // Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ´Ø±ÙØª
                const progress = await lessonEngine.getProgress('user789', 'english-beginner');
                
                if (progress && progress.userId === 'user789' && progress.completionPercentage >= 0) {
                    recordResult(8, true, `Ù¾ÛŒØ´Ø±ÙØª Ú©Ø§Ø±Ø¨Ø±: ${progress.completionPercentage}% ØªÚ©Ù…ÛŒÙ„`);
                } else {
                    recordResult(8, false, 'Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ´Ø±ÙØª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯');
                }
            } catch (error) {
                recordResult(8, false, `Ø®Ø·Ø§: ${error.message}`);
            }
        }
        
        async function testFullScenario() {
            try {
                log('ğŸ¬ Ø´Ø±ÙˆØ¹ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ú©Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±...', 'info');
                
                // 1. Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯ÙˆØ±Ù‡
                const course = await lessonEngine.loadCourse('english-beginner', 'en');
                
                // 2. Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³ Ø§ÙˆÙ„
                const session = await lessonEngine.startLesson('lesson1', 'user999');
                
                // 3. Ø§Ù†Ø¬Ø§Ù… ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§
                const results = [];
                
                // ØªÙ…Ø±ÛŒÙ† Ø§ÙˆÙ„
                const result1 = await lessonEngine.submitExercise({
                    sessionId: session.id,
                    exerciseId: 'ex1',
                    answers: ['I am fine'],
                    timeSpent: 25
                });
                results.push(result1);
                
                // ØªÙ…Ø±ÛŒÙ† Ø¯ÙˆÙ…
                const result2 = await lessonEngine.submitExercise({
                    sessionId: session.id,
                    exerciseId: 'ex2',
                    answers: ['Hello'],
                    timeSpent: 35
                });
                results.push(result2);
                
                // 4. Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ´Ø±ÙØª
                const progress = await lessonEngine.getProgress('user999', 'english-beginner');
                
                // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ù†ØªØ§ÛŒØ¬
                const allCorrect = results.every(r => r.isCorrect);
                const totalScore = results.reduce((sum, r) => sum + r.score, 0);
                
                if (allCorrect && progress.completionPercentage > 0 && totalScore === 25) {
                    recordResult(9, true, `Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ú©Ø§Ù…Ù„ Ù…ÙˆÙÙ‚ - Ù†Ù…Ø±Ù‡ Ú©Ù„: ${totalScore} - Ù¾ÛŒØ´Ø±ÙØª: ${progress.completionPercentage}%`);
                    log('ğŸ‰ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ú©Ø§Ù…Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯!', 'success');
                } else {
                    recordResult(9, false, 'Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ú©Ø§Ù…Ù„ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯');
                }
                
            } catch (error) {
                recordResult(9, false, `Ø®Ø·Ø§ Ø¯Ø± Ø³Ù†Ø§Ø±ÛŒÙˆ: ${error.message}`);
            }
        }
        
        // ==================== Run All Tests ====================
        
        async function runAllTests() {
            log('ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§...', 'warning');
            startTime = Date.now();
            
            // Ø±ÛŒØ³Øª Ù†ØªØ§ÛŒØ¬
            testResults = { passed: 0, failed: 0, total: 0 };
            document.getElementById('log').innerHTML = '';
            document.getElementById('event-log').innerHTML = '';
            
            // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
            const initialized = await initialize();
            if (!initialized) {
                log('âŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚ - ØªØ³Øªâ€ŒÙ‡Ø§ Ù…ØªÙˆÙ‚Ù Ø´Ø¯', 'error');
                return;
            }
            
            // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ ØªØ±ØªÛŒØ¨
            await testConstruction();
            await testConstructionError();
            await testLoadCourse();
            await testLoadCourseError();
            await testStartLesson();
            await testSubmitExerciseCorrect();
            await testSubmitExerciseWrong();
            await testGetProgress();
            await testFullScenario();
            
            // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            log(`\nğŸ“Š Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ: ${testResults.passed} Ù…ÙˆÙÙ‚ / ${testResults.failed} Ù†Ø§Ù…ÙˆÙÙ‚ - Ø²Ù…Ø§Ù†: ${elapsed} Ø«Ø§Ù†ÛŒÙ‡`, 
                testResults.failed === 0 ? 'success' : 'warning');
            
            if (testResults.failed === 0) {
                log('ğŸ‰ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Lesson Engine Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú¯Ø°Ø±Ø§Ù†Ø¯Ù‡ Ø´Ø¯Ù†Ø¯!', 'success');
            }
        }
        
        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ù‡Ù†Ú¯Ø§Ù… Ù„ÙˆØ¯ ØµÙØ­Ù‡
        document.addEventListener('DOMContentLoaded', async () => {
            log('ØµÙØ­Ù‡ ØªØ³Øª Lesson Engine Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯', 'info');
            await initialize();
        });
        
        // Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† ØªÙˆØ§Ø¨Ø¹ ØªØ³Øª Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
        window.testConstruction = testConstruction;
        window.testConstructionError = testConstructionError;
        window.testLoadCourse = testLoadCourse;
        window.testLoadCourseError = testLoadCourseError;
        window.testStartLesson = testStartLesson;
        window.testSubmitExerciseCorrect = testSubmitExerciseCorrect;
        window.testSubmitExerciseWrong = testSubmitExerciseWrong;
        window.testGetProgress = testGetProgress;
        window.testFullScenario = testFullScenario;
        window.runAllTests = runAllTests;
    </script>
</body>
</html>
```
