// ==================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª ====================
const MODULES = {
    core: [
        'event_bus.js', 'utils.js', 'state.js',
        'state_manager.js', 'router.js', 'database.js',
        'api.js', 'api_client.js', 'config.js',
        'context_provider.js', 'font_manager.js'
    ],
    auth: [
        'auth_utils.js', 'auth_validator.js',
        'token_manager.js', 'session_service.js',
        'permission_checker.js', 'auth_analytics.js',
        'auth_middleware.js', 'auth_manager.js'
    ],
    lessons: ['lesson_engine.js', 'lesson_content.js', 'lesson_progress.js'],
    pages: ['auth/page.js', 'auth/view.js', 'auth/controller.js', 'home/page.js', 'home/view.js'],
    components: ['Button.js', 'Card.js', 'Input.js', 'Modal.js', 'ProgressBar.js'],
    layouts: ['header.js', 'footer.js', 'main_layout.js']
};

// ==================== Ø³ÛŒØ³ØªÙ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ ====================
async function loadModule(group, file, delay = 300) {
    const path = `./${group}/${file}`;
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            const script = document.createElement('script');
            script.src = path;
            script.type = 'module';
            script.onload = () => resolve({group, file, status: 'loaded'});
            script.onerror = () => reject({group, file, status: 'failed'});
            document.head.appendChild(script);
        }, delay);
    });
}

// ==================== Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª ====================
async function runAllTests() {
    const results = [];
    
    // Ù…Ø±Ø­Ù„Ù‡ Û±: Ù‡Ø³ØªÙ‡ (Ø¨Ø¯ÙˆÙ† ØªØ§Ø®ÛŒØ±)
    for (const file of MODULES.core) {
        results.push(await loadModule('core', file, 0).catch(e => e));
    }
    
    // Ù…Ø±Ø­Ù„Ù‡ Û²: Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§ Ùˆ ØµÙØ­Ø§Øª (Ø¨Ø§ ØªØ§Ø®ÛŒØ± Û³Û°Û°ms)
    const groups = ['components', 'layouts', 'pages', 'auth', 'lessons'];
    for (const group of groups) {
        for (const file of MODULES[group]) {
            results.push(await loadModule(group, file, 300).catch(e => e));
        }
    }
    
    // ==================== Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ ====================
    console.log('ðŸ“Š Ù†ØªØ§ÛŒØ¬ Ù†Ù‡Ø§ÛŒÛŒ:');
    results.forEach(result => {
        const icon = result.status === 'loaded' ? 'âœ…' : 'âŒ';
        console.log(`${icon} ${result.group}/${result.file}`);
    });
    
    const loaded = results.filter(r => r.status === 'loaded').length;
    console.log(`\nðŸŽ¯ Ù…ÙˆÙÙ‚: ${loaded} Ø§Ø² ${results.length} ÙØ§ÛŒÙ„`);
    
    // Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù‚Ø¯Ù… Ø¨Ø¹Ø¯ÛŒ
    if (loaded > 30) {
        console.log('ðŸš€ Ø¹Ø§Ù„ÛŒ! Ø­Ø§Ù„Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ app.js Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒ.');
    }
}

// ==================== Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ ====================
function createTestButtons() {
    const container = document.getElementById('test-buttons') || document.body;
    
    // Ø¯Ú©Ù…Ù‡ Ø§ØµÙ„ÛŒ
    const mainBtn = document.createElement('button');
    mainBtn.textContent = 'ðŸš€ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ú©Ø§Ù…Ù„ (Û³Û¸ ÙØ§ÛŒÙ„)';
    mainBtn.onclick = runAllTests;
    container.appendChild(mainBtn);
    
    // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ
    Object.keys(MODULES).forEach(group => {
        const btn = document.createElement('button');
        btn.textContent = `ðŸ§ª ØªØ³Øª ${group} (${MODULES[group].length} ÙØ§ÛŒÙ„)`;
        btn.onclick = () => testGroup(group);
        container.appendChild(btn);
    });
}

// ==================== Ø§Ø¬Ø±Ø§ ====================
document.addEventListener('DOMContentLoaded', createTestButtons);
