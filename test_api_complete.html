<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ… API Ùˆ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ - Vakamova</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        .api-badge {
            background: #f59e0b;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            display: inline-block;
            margin-top: 10px;
        }
        .test-container {
            padding: 25px;
        }
        .test-section {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid #e2e8f0;
        }
        .test-section h2 {
            color: #059669;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #e2e8f0;
            transition: all 0.3s;
        }
        .test-item.passed {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        .test-item.failed {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .test-item.network {
            border-left-color: #3b82f6;
            background: #eff6ff;
        }
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .test-title {
            font-weight: 600;
            color: #1f2937;
            flex: 1;
        }
        .test-network {
            font-size: 0.8rem;
            background: #3b82f6;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            margin-right: 10px;
        }
        .test-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        .status-passed {
            background: #d1fae5;
            color: #065f46;
        }
        .status-failed {
            background: #fee2e2;
            color: #991b1b;
        }
        .test-output {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background: #1e293b;
            color: #e2e8f0;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .test-output.success {
            background: #0f766e;
        }
        .test-output.error {
            background: #7f1d1d;
        }
        .test-output.warning {
            background: #92400e;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 25px;
            background: #f8fafc;
            border-top: 2px solid #e2e8f0;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            min-width: 180px;
        }
        #run-tests {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        #run-tests:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }
        #run-tests:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        #run-network, #run-sync, #run-security {
            background: #3b82f6;
            color: white;
        }
        #clear-results, #export-results {
            background: #6b7280;
            color: white;
        }
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            padding: 20px;
            background: #f1f5f9;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        @media (max-width: 1200px) {
            .stats {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        @media (max-width: 768px) {
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .stat-box {
            text-align: center;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
        }
        .success { color: #10b981; }
        .failure { color: #ef4444; }
        .pending { color: #f59e0b; }
        .network-color { color: #3b82f6; }
        .security-color { color: #8b5cf6; }
        
        .api-simulator {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 992px) {
            .api-simulator {
                grid-template-columns: 1fr;
            }
        }
        .api-simulator h3 {
            color: #059669;
            margin-bottom: 15px;
            grid-column: 1 / -1;
        }
        .sim-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .api-endpoint {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .api-endpoint:hover {
            background: #e2e8f0;
            transform: translateX(5px);
        }
        .api-method {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            min-width: 60px;
            text-align: center;
        }
        .method-get { background: #10b981; }
        .method-post { background: #3b82f6; }
        .method-put { background: #f59e0b; }
        .method-delete { background: #ef4444; }
        .method-patch { background: #8b5cf6; }
        
        .api-path {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #4b5563;
            flex: 1;
        }
        
        .network-simulator {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .network-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #374151;
            border-radius: 6px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-online { background: #10b981; }
        .status-offline { background: #ef4444; }
        .status-slow { background: #f59e0b; }
        
        .request-log {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #4b5563;
        }
        
        .log-entry {
            padding: 5px;
            border-bottom: 1px solid #374151;
            font-size: 0.8rem;
        }
        
        .log-success { color: #10b981; }
        .log-error { color: #ef4444; }
        .log-warning { color: #f59e0b; }
        
        .sync-visualizer {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            grid-column: 1 / -1;
        }
        
        .sync-status {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .sync-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .sync-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #059669;
        }
        
        .sync-label {
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        @media (max-width: 768px) {
            .test-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .controls {
                flex-direction: column;
            }
            button {
                width: 100%;
                justify-content: center;
            }
            .sync-status {
                flex-direction: column;
            }
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .metric {
            background: #1e293b;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.2rem;
            color: #60a5fa;
            font-weight: bold;
        }
        
        .metric-label {
            font-size: 0.8rem;
            color: #9ca3af;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ ØªØ³Øª Ú©Ø§Ù…Ù„ Ø³ÛŒØ³ØªÙ… API Ùˆ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ - Vakamova</h1>
            <p>Ø¨Ø±Ø±Ø³ÛŒ Ø¬Ø§Ù…Ø¹ API ClientØŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¨Ú©Ù‡ØŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø§Ù…Ù†ÛŒØª Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª</p>
            <div class="api-badge">REST + WebSocket + Sync</div>
        </header>
        
        <div class="stats">
            <div class="stat-box">
                <div class="stat-value success" id="passed-count">0</div>
                <div class="stat-label">Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat-box">
                <div class="stat-value failure" id="failed-count">0</div>
                <div class="stat-label">Ù†Ø§Ù…ÙˆÙÙ‚</div>
            </div>
            <div class="stat-box">
                <div class="stat-value network-color" id="network-count">0</div>
                <div class="stat-label">ØªØ³Øª Ø´Ø¨Ú©Ù‡</div>
            </div>
            <div class="stat-box">
                <div class="stat-value security-color" id="security-count">0</div>
                <div class="stat-label">Ø§Ù…Ù†ÛŒØªÛŒ</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="request-count">0</div>
                <div class="stat-label">Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§</div>
            </div>
            <div class="stat-box">
                <div class="stat-value pending" id="pending-count">0</div>
                <div class="stat-label">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
            </div>
        </div>
        
        <div class="api-simulator">
            <h3>ğŸ® Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² API Ùˆ Ø´Ø¨Ú©Ù‡</h3>
            
            <div class="sim-controls">
                <div class="network-status">
                    <div class="status-indicator status-online" id="network-status"></div>
                    <span id="network-status-text">Ø¢Ù†Ù„Ø§ÛŒÙ† - Ø³Ø±Ø¹Øª Ø¹Ø§Ø¯ÛŒ</span>
                    <button onclick="toggleNetwork()" style="background: #6b7280; padding: 5px 10px; font-size: 0.8rem;">
                        ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø´Ø¨Ú©Ù‡
                    </button>
                </div>
                
                <div style="margin: 15px 0;">
                    <strong>ğŸ”§ API Endpoints:</strong>
                    <div class="api-endpoint" onclick="simulateApiCall('GET', '/api/users/me')">
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/users/me</span>
                    </div>
                    <div class="api-endpoint" onclick="simulateApiCall('POST', '/api/lessons/sync')">
                        <span class="api-method method-post">POST</span>
                        <span class="api-path">/api/lessons/sync</span>
                    </div>
                    <div class="api-endpoint" onclick="simulateApiCall('GET', '/api/lessons?page=1')">
                        <span class="api-method method-get">GET</span>
                        <span class="api-path">/api/lessons?page=1</span>
                    </div>
                    <div class="api-endpoint" onclick="simulateApiCall('PUT', '/api/progress/123')">
                        <span class="api-method method-put">PUT</span>
                        <span class="api-path">/api/progress/123</span>
                    </div>
                    <div class="api-endpoint" onclick="simulateApiCall('DELETE', '/api/sessions/old')">
                        <span class="api-method method-delete">DELETE</span>
                        <span class="api-path">/api/sessions/old</span>
                    </div>
                </div>
                
                <div style="margin: 15px 0;">
                    <strong>ğŸ”„ Ø¹Ù…Ù„ÛŒØ§Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ:</strong>
                    <button onclick="simulateSync()" style="background: #8b5cf6; margin-bottom: 5px;">
                        <span>ğŸ”„</span> Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    </button>
                    <button onclick="simulateOfflineQueue()" style="background: #f59e0b; margin-bottom: 5px;">
                        <span>ğŸ“¦</span> Ù…Ø¯ÛŒØ±ÛŒØª ØµÙ Ø¢ÙÙ„Ø§ÛŒÙ†
                    </button>
                    <button onclick="simulateConflict()" style="background: #ef4444;">
                        <span>âš”ï¸</span> Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ¯Ø§Ø®Ù„ Ø¯Ø§Ø¯Ù‡
                    </button>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: #f8fafc; border-radius: 8px;">
                    <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 5px;">Ø¢Ø®Ø±ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª:</div>
                    <div id="current-operation" style="font-family: monospace; color: #059669;">Ù‡ÛŒÚ† Ø¹Ù…Ù„ÛŒØ§ØªÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡</div>
                </div>
            </div>
            
            <div class="network-simulator" id="network-simulator">
                <div class="performance-metrics">
                    <div class="metric">
                        <div class="metric-value" id="avg-response">0ms</div>
                        <div class="metric-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù¾Ø§Ø³Ø®</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="success-rate">100%</div>
                        <div class="metric-label">Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="queue-size">0</div>
                        <div class="metric-label">ØµÙ Ø¢ÙÙ„Ø§ÛŒÙ†</div>
                    </div>
                </div>
                
                <div class="request-log" id="request-log">
                    <div class="log-entry">// Ù„Ø§Ú¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ API Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</div>
                    <div class="log-entry log-success">[Û±Û²:Û³Û°:Û´Ûµ] GET /api/health â†’ 200 OK (Û±ÛµÛ°ms)</div>
                </div>
            </div>
        </div>
        
        <div class="sync-visualizer">
            <div class="sync-status">
                <div class="sync-item">
                    <div class="sync-value" id="local-data">Û°</div>
                    <div class="sync-label">Ø¯Ø§Ø¯Ù‡ Ù…Ø­Ù„ÛŒ</div>
                </div>
                <div class="sync-item">
                    <div class="sync-value" id="server-data">Û°</div>
                    <div class="sync-label">Ø¯Ø§Ø¯Ù‡ Ø³Ø±ÙˆØ±</div>
                </div>
                <div class="sync-item">
                    <div class="sync-value" id="pending-sync">Û°</div>
                    <div class="sync-label">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ</div>
                </div>
                <div class="sync-item">
                    <div class="sync-value" id="conflicts">Û°</div>
                    <div class="sync-label">ØªØ¯Ø§Ø®Ù„â€ŒÙ‡Ø§</div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button onclick="forceFullSync()" style="background: #059669; padding: 8px 15px; font-size: 0.9rem;">
                    <span>ğŸ”„</span> Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„
                </button>
                <button onclick="clearSyncData()" style="background: #6b7280; padding: 8px 15px; font-size: 0.9rem;">
                    <span>ğŸ—‘ï¸</span> Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡
                </button>
                <button onclick="simulateRealtime()" style="background: #3b82f6; padding: 8px 15px; font-size: 0.9rem;">
                    <span>âš¡</span> Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Real-time
                </button>
            </div>
        </div>
        
        <div class="test-container" id="test-container">
            <!-- ØªØ³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
        
        <div class="controls">
            <button id="run-tests">
                <span>ğŸš€</span>
                Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
            <button id="run-network">
                <span>ğŸŒ</span>
                ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡
            </button>
            <button id="run-sync">
                <span>ğŸ”„</span>
                ØªØ³Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
            </button>
            <button id="run-security">
                <span>ğŸ›¡ï¸</span>
                ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ
            </button>
            <button id="export-results">
                <span>ğŸ’¾</span>
                Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬
            </button>
            <button id="clear-results">
                <span>ğŸ”„</span>
                Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬
            </button>
        </div>
    </div>

    <script>
        // ============ Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ù„Ø§Ú¯ Ø´Ø¨Ú©Ù‡ ============
        class NetworkLogger {
            constructor() {
                this.logs = [];
                this.requests = [];
                this.maxLogs = 100;
                this.metrics = {
                    totalRequests: 0,
                    successful: 0,
                    failed: 0,
                    totalResponseTime: 0,
                    offlineQueue: 0
                };
            }
            
            logRequest(method, url, status, duration, data = null) {
                const entry = {
                    timestamp: new Date().toISOString(),
                    time: new Date().toLocaleTimeString('fa-IR'),
                    method,
                    url,
                    status,
                    duration,
                    data: this.sanitizeData(data),
                    type: 'request'
                };
                
                this.logs.push(entry);
                this.requests.push(entry);
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§
                this.metrics.totalRequests++;
                if (status >= 200 && status < 300) {
                    this.metrics.successful++;
                } else {
                    this.metrics.failed++;
                }
                this.metrics.totalResponseTime += duration;
                
                // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ØªØ¹Ø¯Ø§Ø¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§
                if (this.logs.length > this.maxLogs) {
                    this.logs.shift();
                }
                if (this.requests.length > 50) {
                    this.requests.shift();
                }
                
                console.log(`[API] ${method} ${url} â†’ ${status} (${duration}ms)`);
                return entry;
            }
            
            logSync(operation, localCount, serverCount, conflicts = 0) {
                const entry = {
                    timestamp: new Date().toISOString(),
                    operation,
                    localCount,
                    serverCount,
                    conflicts,
                    type: 'sync'
                };
                
                this.logs.push(entry);
                console.log(`[Sync] ${operation}: local=${localCount}, server=${serverCount}, conflicts=${conflicts}`);
                return entry;
            }
            
            logError(context, error, request = null) {
                const entry = {
                    timestamp: new Date().toISOString(),
                    context,
                    error: error?.message || error,
                    stack: error?.stack,
                    request,
                    type: 'error'
                };
                
                this.logs.push(entry);
                console.error(`[API Error] ${context}:`, error);
                return entry;
            }
            
            logSecurity(event, details) {
                const entry = {
                    timestamp: new Date().toISOString(),
                    event,
                    details: this.sanitizeData(details),
                    type: 'security'
                };
                
                this.logs.push(entry);
                console.log(`%c[Security] ${event}`, 'color: #8b5cf6; font-weight: bold;', details);
                return entry;
            }
            
            sanitizeData(data) {
                if (!data || typeof data !== 'object') return data;
                
                const sensitiveFields = ['password', 'token', 'secret', 'authorization', 'apikey'];
                const sanitized = { ...data };
                
                sensitiveFields.forEach(field => {
                    if (sanitized[field]) {
                        sanitized[field] = '***REDACTED***';
                    }
                    if (sanitized.headers && sanitized.headers[field]) {
                        sanitized.headers[field] = '***REDACTED***';
                    }
                });
                
                return sanitized;
            }
            
            getMetrics() {
                const avgResponse = this.metrics.totalRequests > 0 
                    ? this.metrics.totalResponseTime / this.metrics.totalRequests 
                    : 0;
                
                const successRate = this.metrics.totalRequests > 0
                    ? (this.metrics.successful / this.metrics.totalRequests) * 100
                    : 100;
                
                return {
                    ...this.metrics,
                    avgResponse,
                    successRate
                };
            }
            
            clear() {
                this.logs = [];
                this.requests = [];
                this.metrics = {
                    totalRequests: 0,
                    successful: 0,
                    failed: 0,
                    totalResponseTime: 0,
                    offlineQueue: 0
                };
            }
        }

        // ============ Mock API Client ============
        class MockApiClient {
            constructor() {
                this.baseURL = 'https://api.vakamova.com/v1';
                this.headers = {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'X-App-Version': '1.0.0',
                    'X-Platform': 'web'
                };
                this.token = null;
                this.refreshToken = null;
                this.isOnline = true;
                this.networkSpeed = 'normal'; // 'slow', 'very-slow', 'offline'
                this.offlineQueue = [];
                this.maxRetries = 3;
                this.timeout = 10000; // 10 seconds
                this.cache = new Map();
                this.syncState = {
                    localData: 0,
                    serverData: 0,
                    pendingSync: 0,
                    conflicts: 0
                };
                
                this.initMockEndpoints();
            }
            
            initMockEndpoints() {
                this.mockEndpoints = {
                    '/api/users/me': {
                        method: 'GET',
                        handler: async () => ({
                            id: 'user_123',
                            email: 'user@vakamova.com',
                            name: 'Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª',
                            role: 'user',
                            preferences: {
                                language: 'fa',
                                theme: 'light'
                            },
                            subscription: {
                                type: 'premium',
                                expiresAt: '2024-12-31'
                            }
                        })
                    },
                    '/api/lessons': {
                        method: 'GET',
                        handler: async (params) => {
                            const page = parseInt(params.page) || 1;
                            const limit = 20;
                            const lessons = [];
                            
                            for (let i = 0; i < limit; i++) {
                                lessons.push({
                                    id: `lesson_${(page - 1) * limit + i}`,
                                    title: `Ø¯Ø±Ø³ ${i + 1} - Ø¢Ù…ÙˆØ²Ø´ Ø²Ø¨Ø§Ù†`,
                                    language: 'english',
                                    level: 'beginner',
                                    duration: 30,
                                    completed: Math.random() > 0.5
                                });
                            }
                            
                            return {
                                lessons,
                                pagination: {
                                    page,
                                    limit,
                                    total: 200,
                                    pages: 10
                                }
                            };
                        }
                    },
                    '/api/lessons/sync': {
                        method: 'POST',
                        handler: async (data) => {
                            const changes = data.changes || [];
                            let conflicts = 0;
                            let synced = 0;
                            
                            for (const change of changes) {
                                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ¯Ø§Ø®Ù„
                                if (Math.random() > 0.8) {
                                    conflicts++;
                                } else {
                                    synced++;
                                }
                            }
                            
                            return {
                                synced,
                                conflicts,
                                timestamp: new Date().toISOString()
                            };
                        }
                    },
                    '/api/progress/:id': {
                        method: 'PUT',
                        handler: async (data, params) => ({
                            id: params.id,
                            ...data,
                            synced: true,
                            updatedAt: new Date().toISOString()
                        })
                    },
                    '/api/sessions/old': {
                        method: 'DELETE',
                        handler: async () => ({
                            deleted: Math.floor(Math.random() * 5) + 1,
                            message: 'Ø³Ø´Ù†â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯'
                        })
                    },
                    '/api/auth/refresh': {
                        method: 'POST',
                        handler: async () => ({
                            token: `new_token_${Date.now()}_${Math.random().toString(36).substr(2, 16)}`,
                            refreshToken: `new_refresh_${Date.now()}_${Math.random().toString(36).substr(2, 16)}`,
                            expiresIn: 3600
                        })
                    }
                };
            }
            
            setToken(token, refreshToken = null) {
                this.token = token;
                this.refreshToken = refreshToken;
                if (token) {
                    this.headers['Authorization'] = `Bearer ${token}`;
                } else {
                    delete this.headers['Authorization'];
                }
            }
            
            setNetworkStatus(online, speed = 'normal') {
                this.isOnline = online;
                this.networkSpeed = speed;
            }
            
            simulateNetworkDelay() {
                let delay = 0;
                
                switch (this.networkSpeed) {
                    case 'very-slow':
                        delay = 2000 + Math.random() * 3000; // 2-5 seconds
                        break;
                    case 'slow':
                        delay = 500 + Math.random() * 1000; // 0.5-1.5 seconds
                        break;
                    case 'normal':
                    default:
                        delay = 100 + Math.random() * 200; // 0.1-0.3 seconds
                        break;
                }
                
                return new Promise(resolve => setTimeout(resolve, delay));
            }
            
            simulateNetworkError() {
                const errors = [
                    { status: 400, message: 'Bad Request' },
                    { status: 401, message: 'Unauthorized' },
                    { status: 403, message: 'Forbidden' },
                    { status: 404, message: 'Not Found' },
                    { status: 429, message: 'Too Many Requests' },
                    { status: 500, message: 'Internal Server Error' },
                    { status: 502, message: 'Bad Gateway' },
                    { status: 503, message: 'Service Unavailable' },
                    { status: 504, message: 'Gateway Timeout' }
                ];
                
                return errors[Math.floor(Math.random() * errors.length)];
            }
            
            async request(method, path, data = null, options = {}) {
                const startTime = performance.now();
                const url = path.startsWith('http') ? path : `${this.baseURL}${path}`;
                
                // Ø§Ú¯Ø± Ø¢ÙÙ„Ø§ÛŒÙ† Ø¨Ø§Ø´ÛŒÙ…ØŒ Ø¯Ø± ØµÙ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…
                if (!this.isOnline && method !== 'GET') {
                    this.offlineQueue.push({
                        method,
                        path,
                        data,
                        timestamp: Date.now(),
                        id: `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
                    });
                    
                    throw new Error('Ø´Ø¨Ú©Ù‡ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± ØµÙ Ø¢ÙÙ„Ø§ÛŒÙ† Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØª.');
                }
                
                try {
                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ£Ø®ÛŒØ± Ø´Ø¨Ú©Ù‡
                    await this.simulateNetworkDelay();
                    
                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ Ø´Ø¨Ú©Ù‡
                    if (Math.random() < 0.1) { // 10% chance of error
                        const error = this.simulateNetworkError();
                        throw {
                            status: error.status,
                            message: error.message,
                            url
                        };
                    }
                    
                    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† endpoint Ù…Ù†Ø§Ø³Ø¨
                    let endpoint = null;
                    let params = {};
                    
                    for (const [pattern, endpointConfig] of Object.entries(this.mockEndpoints)) {
                        if (endpointConfig.method !== method) continue;
                        
                        if (pattern.includes(':')) {
                            const patternParts = pattern.split('/');
                            const pathParts = path.split('/');
                            
                            if (patternParts.length === pathParts.length) {
                                let match = true;
                                const extractedParams = {};
                                
                                for (let i = 0; i < patternParts.length; i++) {
                                    if (patternParts[i].startsWith(':')) {
                                        const paramName = patternParts[i].substring(1);
                                        extractedParams[paramName] = pathParts[i];
                                    } else if (patternParts[i] !== pathParts[i]) {
                                        match = false;
                                        break;
                                    }
                                }
                                
                                if (match) {
                                    endpoint = endpointConfig;
                                    params = extractedParams;
                                    break;
                                }
                            }
                        } else if (pattern === path) {
                            endpoint = endpointConfig;
                            break;
                        }
                    }
                    
                    if (!endpoint) {
                        throw {
                            status: 404,
                            message: 'Endpoint not found',
                            url
                        };
                    }
                    
                    // Ø§Ø¬Ø±Ø§ÛŒ handler
                    const responseData = await endpoint.handler(data, params);
                    
                    const duration = performance.now() - startTime;
                    
                    return {
                        success: true,
                        status: 200,
                        data: responseData,
                        headers: this.headers,
                        duration,
                        url
                    };
                    
                } catch (error) {
                    const duration = performance.now() - startTime;
                    
                    // ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø®Ø§Øµ
                    if (error.status >= 500 && options.retryCount < this.maxRetries) {
                        console.log(`Retrying request... (attempt ${options.retryCount + 1})`);
                        return this.request(method, path, data, {
                            ...options,
                            retryCount: (options.retryCount || 0) + 1
                        });
                    }
                    
                    return {
                        success: false,
                        status: error.status || 0,
                        error: error.message || 'Network Error',
                        duration,
                        url
                    };
                }
            }
            
            async get(path, params = {}) {
                const queryString = Object.keys(params).length > 0
                    ? '?' + new URLSearchParams(params).toString()
                    : '';
                return this.request('GET', path + queryString);
            }
            
            async post(path, data) {
                return this.request('POST', path, data);
            }
            
            async put(path, data) {
                return this.request('PUT', path, data);
            }
            
            async delete(path) {
                return this.request('DELETE', path);
            }
            
            async patch(path, data) {
                return this.request('PATCH', path, data);
            }
            
            // ============ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ============
            
            async syncData(localChanges = []) {
                if (!this.isOnline) {
                    this.syncState.pendingSync += localChanges.length;
                    throw new Error('Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¢ÙÙ„Ø§ÛŒÙ† Ø§Ø³Øª');
                }
                
                try {
                    const result = await this.post('/api/lessons/sync', { changes: localChanges });
                    
                    if (result.success) {
                        this.syncState.localData += localChanges.length;
                        this.syncState.serverData += result.data.synced;
                        this.syncState.conflicts += result.data.conflicts;
                        this.syncState.pendingSync = Math.max(0, this.syncState.pendingSync - localChanges.length);
                        
                        return {
                            success: true,
                            synced: result.data.synced,
                            conflicts: result.data.conflicts,
                            state: { ...this.syncState }
                        };
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    this.syncState.pendingSync += localChanges.length;
                    throw error;
                }
            }
            
            processOfflineQueue() {
                if (!this.isOnline || this.offlineQueue.length === 0) {
                    return { processed: 0, failed: 0 };
                }
                
                let processed = 0;
                let failed = 0;
                
                const queueCopy = [...this.offlineQueue];
                this.offlineQueue = [];
                
                // Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø§ÛŒÙ†Ø¬Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
                // Ø¨Ø±Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒØŒ ÙØ±Ø¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ù‡Ù…Ù‡ Ù…ÙˆÙÙ‚ Ù‡Ø³ØªÙ†Ø¯
                processed = queueCopy.length;
                
                return { processed, failed };
            }
            
            getSyncState() {
                return { ...this.syncState };
            }
            
            updateSyncState(updates) {
                this.syncState = { ...this.syncState, ...updates };
                return this.syncState;
            }
            
            clearOfflineQueue() {
                const count = this.offlineQueue.length;
                this.offlineQueue = [];
                return count;
            }
        }

        // ============ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… API ============
        const API_TEST_SUITES = [
            {
                id: 'api-core',
                name: 'Ù‡Ø³ØªÙ‡ API Client',
                icon: 'ğŸ”Œ',
                tests: [
                    {
                        id: 'api-request-basic',
                        name: 'Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ GET Ùˆ POST Ø³Ø§Ø¯Ù‡',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // ØªØ³Øª GET
                            const getResult = await api.get('/api/users/me');
                            if (!getResult.success) throw new Error('Ø¯Ø±Ø®ÙˆØ§Ø³Øª GET Ù†Ø§Ù…ÙˆÙÙ‚');
                            if (!getResult.data.id) throw new Error('Ø¯Ø§Ø¯Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ù†Ø´Ø¯');
                            
                            // ØªØ³Øª POST
                            const postResult = await api.post('/api/lessons/sync', {
                                changes: [{ id: '1', type: 'progress', value: 100 }]
                            });
                            
                            if (!postResult.success) throw new Error('Ø¯Ø±Ø®ÙˆØ§Ø³Øª POST Ù†Ø§Ù…ÙˆÙÙ‚');
                            if (typeof postResult.data.synced !== 'number') throw new Error('Ø¯Ø§Ø¯Ù‡ sync Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ù†Ø´Ø¯');
                            
                            return `âœ… Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ Ù…ÙˆÙÙ‚. GET: ${getResult.duration.toFixed(0)}ms, POST: ${postResult.duration.toFixed(0)}ms`;
                        }
                    },
                    {
                        id: 'api-headers-auth',
                        name: 'Headers Ùˆ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø±Ø³Ø§Ù„ headers Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª token',
                        network: false,
                        security: true,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // ØªØ³Øª Ø¨Ø¯ÙˆÙ† token
                            const result1 = await api.get('/api/users/me');
                            if (!result1.headers['Authorization']) throw new Error('Header Authorization ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
                            
                            // ØªÙ†Ø¸ÛŒÙ… token
                            const testToken = 'test_token_123';
                            api.setToken(testToken);
                            
                            // ØªØ³Øª Ø¨Ø§ token
                            const result2 = await api.get('/api/users/me');
                            if (result2.headers['Authorization'] !== `Bearer ${testToken}`) {
                                throw new Error('Token Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯');
                            }
                            
                            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† token
                            api.setToken(null);
                            const result3 = await api.get('/api/users/me');
                            if (result3.headers['Authorization']) throw new Error('Token Ù¾Ø³ Ø§Ø² Ù¾Ø§Ú© Ø´Ø¯Ù† Ù‡Ù…Ú†Ù†Ø§Ù† Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯');
                            
                            return 'âœ… Ù…Ø¯ÛŒØ±ÛŒØª headers Ùˆ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª ØµØ­ÛŒØ­ Ø§Ø³Øª';
                        }
                    },
                    {
                        id: 'api-params-query',
                        name: 'Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ Ùˆ Query Strings',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ query Ùˆ body',
                        network: false,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // ØªØ³Øª query parameters
                            const queryResult = await api.get('/api/lessons', {
                                page: 2,
                                limit: 10,
                                language: 'english',
                                level: 'intermediate'
                            });
                            
                            if (!queryResult.success) throw new Error('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§ query parameters Ù†Ø§Ù…ÙˆÙÙ‚');
                            if (!queryResult.data.pagination) throw new Error('Ø¯Ø§Ø¯Ù‡ pagination Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ù†Ø´Ø¯');
                            if (queryResult.data.pagination.page !== 2) throw new Error('Ù¾Ø§Ø±Ø§Ù…ØªØ± page Ø§Ø¹Ù…Ø§Ù„ Ù†Ø´Ø¯');
                            
                            // ØªØ³Øª body parameters
                            const bodyData = {
                                title: 'Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯',
                                content: 'Ù…Ø­ØªÙˆØ§ ØªØ³Øª',
                                difficulty: 'medium'
                            };
                            
                            const postResult = await api.post('/api/lessons/sync', {
                                changes: [bodyData]
                            });
                            
                            if (!postResult.success) throw new Error('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§ body Ù†Ø§Ù…ÙˆÙÙ‚');
                            
                            return 'âœ… Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ query Ùˆ body Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯';
                        }
                    },
                    {
                        id: 'api-timeout-retry',
                        name: 'Timeout Ùˆ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ timeout Ùˆ Ù…Ù†Ø·Ù‚ retry Ø¨Ø±Ø§ÛŒ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // ØªÙ†Ø¸ÛŒÙ… Ø³Ø±Ø¹Øª Ø¨Ø³ÛŒØ§Ø± Ù¾Ø§ÛŒÛŒÙ† Ø´Ø¨Ú©Ù‡
                            api.setNetworkStatus(true, 'very-slow');
                            
                            const startTime = performance.now();
                            const result = await api.get('/api/users/me');
                            const duration = performance.now() - startTime;
                            
                            if (duration < 2000) {
                                throw new Error(`Timeout Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§: ${duration.toFixed(0)}ms`);
                            }
                            
                            if (!result.success) throw new Error('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§ Ø³Ø±Ø¹Øª Ù¾Ø§ÛŒÛŒÙ† Ù†Ø§Ù…ÙˆÙÙ‚');
                            
                            // Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ
                            api.setNetworkStatus(true, 'normal');
                            
                            return `âœ… Timeout Ùˆ retry ÙØ¹Ø§Ù„. Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§: ${duration.toFixed(0)}ms`;
                        }
                    }
                ]
            },
            {
                id: 'api-network',
                name: 'Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¨Ú©Ù‡',
                icon: 'ğŸŒ',
                tests: [
                    {
                        id: 'api-offline-handling',
                        name: 'Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙØªØ§Ø± Ø³ÛŒØ³ØªÙ… Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // Ø±ÙØªÙ† Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†
                            api.setNetworkStatus(false);
                            
                            // ØªØ³Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª GET Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†
                            try {
                                await api.get('/api/users/me');
                                // Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¯Ù‡Ø¯
                                throw new Error('Ø¯Ø±Ø®ÙˆØ§Ø³Øª GET Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ† Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯');
                            } catch (error) {
                                if (!error.message.includes('Ø´Ø¨Ú©Ù‡')) {
                                    throw new Error(`Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨: ${error.message}`);
                                }
                            }
                            
                            // ØªØ³Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª POST Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†
                            try {
                                await api.post('/api/lessons/sync', { changes: [] });
                                throw new Error('Ø¯Ø±Ø®ÙˆØ§Ø³Øª POST Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ† Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯');
                            } catch (error) {
                                if (!error.message.includes('ØµÙ Ø¢ÙÙ„Ø§ÛŒÙ†')) {
                                    throw new Error(`Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ ØµÙ: ${error.message}`);
                                }
                            }
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ ØµÙ Ø¢ÙÙ„Ø§ÛŒÙ†
                            if (api.offlineQueue.length === 0) {
                                throw new Error('Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ POST Ø¯Ø± ØµÙ Ø¢ÙÙ„Ø§ÛŒÙ† Ù‚Ø±Ø§Ø± Ù†Ú¯Ø±ÙØªÙ†Ø¯');
                            }
                            
                            // Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¢Ù†Ù„Ø§ÛŒÙ†
                            api.setNetworkStatus(true);
                            
                            return `âœ… Ù…Ø¯ÛŒØ±ÛŒØª Ø¢ÙÙ„Ø§ÛŒÙ† ÙØ¹Ø§Ù„. ${api.offlineQueue.length} Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± ØµÙ`;
                        }
                    },
                    {
                        id: 'api-network-errors',
                        name: 'Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ù…Ø®ØªÙ„Ù',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ§Ú©Ù†Ø´ Ø¨Ù‡ Ø®Ø·Ø§Ù‡Ø§ÛŒ HTTP Ù…Ø®ØªÙ„Ù',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            let errorCount = 0;
                            
                            // ØªØ³Øª Ú†Ù†Ø¯ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ø§ÛŒ Ø´Ø§Ù†Ø³ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø®Ø·Ø§
                            for (let i = 0; i < 10; i++) {
                                const result = await api.get('/api/users/me');
                                if (!result.success) {
                                    errorCount++;
                                    console.log(`Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: ${result.status} - ${result.error}`);
                                }
                            }
                            
                            if (errorCount === 0) {
                                // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ù†Ø¯Ø§Ø¯ØŒ Ø¨Ø§Ø² Ù‡Ù… Ù…ÙˆÙÙ‚ Ø¯Ø± Ù†Ø¸Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ…
                                return 'âœ… Ø³ÛŒØ³ØªÙ… Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ù¾Ø§ÛŒØ¯Ø§Ø± Ø§Ø³Øª (Ù‡ÛŒÚ† Ø®Ø·Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ Ø±Ø® Ù†Ø¯Ø§Ø¯)';
                            }
                            
                            return `âœ… Ø³ÛŒØ³ØªÙ… Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (${errorCount} Ø®Ø·Ø§ Ø±Ø® Ø¯Ø§Ø¯)`;
                        }
                    },
                    {
                        id: 'api-slow-network',
                        name: 'Ø´Ø¨Ú©Ù‡ Ú©Ù†Ø¯',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø± Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†Ø¯',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // ØªØ³Øª Ø³Ø±Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
                            const speeds = ['normal', 'slow', 'very-slow'];
                            const results = [];
                            
                            for (const speed of speeds) {
                                api.setNetworkStatus(true, speed);
                                const startTime = performance.now();
                                const result = await api.get('/api/users/me');
                                const duration = performance.now() - startTime;
                                
                                results.push({
                                    speed,
                                    duration: Math.round(duration),
                                    success: result.success
                                });
                            }
                            
                            // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ
                            api.setNetworkStatus(true, 'normal');
                            
                            const summary = results.map(r => `${r.speed}: ${r.duration}ms`).join(', ');
                            return `âœ… Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯Ø± Ø³Ø±Ø¹Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù: ${summary}`;
                        }
                    },
                    {
                        id: 'api-queue-processing',
                        name: 'Ù¾Ø±Ø¯Ø§Ø²Ø´ ØµÙ Ø¢ÙÙ„Ø§ÛŒÙ†',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¯Ø± ØµÙ',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // Ø±ÙØªÙ† Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ† Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙ
                            api.setNetworkStatus(false);
                            
                            const requestsToAdd = 5;
                            for (let i = 0; i < requestsToAdd; i++) {
                                try {
                                    await api.post('/api/lessons/sync', {
                                        changes: [{ id: i, type: 'test' }]
                                    });
                                } catch (error) {
                                    // Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø§Ø±ÛŒÙ… Ø®Ø·Ø§ Ø¯Ù‡Ø¯
                                }
                            }
                            
                            if (api.offlineQueue.length !== requestsToAdd) {
                                throw new Error(`ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØµÙ Ø§Ø´ØªØ¨Ø§Ù‡: ${api.offlineQueue.length} Ø§Ø² ${requestsToAdd}`);
                            }
                            
                            // Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¢Ù†Ù„Ø§ÛŒÙ† Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´ ØµÙ
                            api.setNetworkStatus(true);
                            const processResult = api.processOfflineQueue();
                            
                            if (processResult.processed !== requestsToAdd) {
                                throw new Error(`Ù¾Ø±Ø¯Ø§Ø²Ø´ ØµÙ Ù†Ø§Ù…ÙˆÙÙ‚: ${processResult.processed} Ø§Ø² ${requestsToAdd}`);
                            }
                            
                            if (api.offlineQueue.length !== 0) {
                                throw new Error(`ØµÙ Ù¾Ø³ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®Ø§Ù„ÛŒ Ù†ÛŒØ³Øª: ${api.offlineQueue.length} Ø¢ÛŒØªÙ…`);
                            }
                            
                            return `âœ… ØµÙ Ø¢ÙÙ„Ø§ÛŒÙ† Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯: ${processResult.processed} Ø¯Ø±Ø®ÙˆØ§Ø³Øª`;
                        }
                    }
                ]
            },
            {
                id: 'api-sync',
                name: 'Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡',
                icon: 'ğŸ”„',
                tests: [
                    {
                        id: 'api-sync-basic',
                        name: 'Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§ÛŒÙ‡',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø§ØµÙ„ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // Ø§ÛŒØ¬Ø§Ø¯ ØªØºÛŒÛŒØ±Ø§Øª Ù…Ø­Ù„ÛŒ
                            const localChanges = [
                                { id: '1', type: 'progress', value: 50, timestamp: Date.now() },
                                { id: '2', type: 'progress', value: 75, timestamp: Date.now() },
                                { id: '3', type: 'progress', value: 100, timestamp: Date.now() }
                            ];
                            
                            // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ
                            const syncResult = await api.syncData(localChanges);
                            
                            if (!syncResult.success) throw new Error('Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚');
                            if (syncResult.synced + syncResult.conflicts !== localChanges.length) {
                                throw new Error('ØªØ¹Ø¯Ø§Ø¯ ØªØºÛŒÛŒØ±Ø§Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ´Ø¯Ù‡ Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ø¯');
                            }
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª sync
                            const syncState = api.getSyncState();
                            if (syncState.localData === 0) throw new Error('Ø¯Ø§Ø¯Ù‡ Ù…Ø­Ù„ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ² Ù†Ø´Ø¯');
                            
                            return `âœ… Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù…ÙˆÙÙ‚. Ù‡Ù…Ú¯Ø§Ù…â€ŒØ´Ø¯Ù‡: ${syncResult.synced}, ØªØ¯Ø§Ø®Ù„: ${syncResult.conflicts}`;
                        }
                    },
                    {
                        id: 'api-sync-conflict',
                        name: 'Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¯Ø§Ø®Ù„ Ø¯Ø§Ø¯Ù‡',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¯Ø§Ø®Ù„â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ ØªØºÛŒÛŒØ±Ø§Øª Ø²ÛŒØ§Ø¯
                            const manyChanges = [];
                            for (let i = 0; i < 20; i++) {
                                manyChanges.push({
                                    id: `item_${i}`,
                                    type: 'lesson',
                                    progress: Math.random() * 100,
                                    timestamp: Date.now() - Math.random() * 10000
                                });
                            }
                            
                            const syncResult = await api.syncData(manyChanges);
                            
                            if (!syncResult.success) throw new Error('Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ ØªØ¯Ø§Ø®Ù„ Ù†Ø§Ù…ÙˆÙÙ‚');
                            
                            // ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ÛŒØ¯ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
                            const syncState = api.getSyncState();
                            if (syncState.conflicts === 0) {
                                // Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø´Ø§Ù†Ø³ÛŒ Ù‡ÛŒÚ† ØªØ¯Ø§Ø®Ù„ÛŒ Ø±Ø® Ù†Ø¯Ø§Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
                                console.log('Ù‡ÛŒÚ† ØªØ¯Ø§Ø®Ù„ÛŒ Ø±Ø® Ù†Ø¯Ø§Ø¯ (Ø´Ø§Ù†Ø³ÛŒ)');
                            }
                            
                            return `âœ… ØªØ¯Ø§Ø®Ù„â€ŒÙ‡Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¯Ù†Ø¯. ØªØ¯Ø§Ø®Ù„: ${syncResult.conflicts}`;
                        }
                    },
                    {
                        id: 'api-sync-offline',
                        name: 'Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¢ÙÙ„Ø§ÛŒÙ†',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙØªØ§Ø± Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // Ø±ÙØªÙ† Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†
                            api.setNetworkStatus(false);
                            
                            // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ (Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¯Ù‡Ø¯)
                            const localChanges = [{ id: '1', type: 'test' }];
                            let syncError = false;
                            
                            try {
                                await api.syncData(localChanges);
                            } catch (error) {
                                syncError = true;
                                if (!error.message.includes('Ø¢ÙÙ„Ø§ÛŒÙ†')) {
                                    throw new Error(`Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨: ${error.message}`);
                                }
                            }
                            
                            if (!syncError) throw new Error('Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¢ÙÙ„Ø§ÛŒÙ† Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯');
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ pending sync
                            const syncState = api.getSyncState();
                            if (syncState.pendingSync !== localChanges.length) {
                                throw new Error('ØªØ¹Ø¯Ø§Ø¯ pending sync Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
                            }
                            
                            // Ø¨Ø±Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¢Ù†Ù„Ø§ÛŒÙ†
                            api.setNetworkStatus(true);
                            
                            // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯
                            const syncResult = await api.syncData(localChanges);
                            if (!syncResult.success) throw new Error('Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø³ Ø§Ø² Ø¢Ù†Ù„Ø§ÛŒÙ† Ø´Ø¯Ù† Ù†Ø§Ù…ÙˆÙÙ‚');
                            
                            return `âœ… Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¢ÙÙ„Ø§ÛŒÙ† Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¯. Pending: ${syncState.pendingSync}`;
                        }
                    },
                    {
                        id: 'api-sync-batch',
                        name: 'Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø¬ÛŒÙ…',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø¬ÛŒÙ…
                            const batchSize = 50;
                            const largeBatch = [];
                            
                            for (let i = 0; i < batchSize; i++) {
                                largeBatch.push({
                                    id: `batch_${i}`,
                                    type: 'progress',
                                    lessonId: `lesson_${Math.floor(i / 10)}`,
                                    score: Math.random() * 100,
                                    timestamp: Date.now() - i * 1000
                                });
                            }
                            
                            const startTime = performance.now();
                            const syncResult = await api.syncData(largeBatch);
                            const duration = performance.now() - startTime;
                            
                            if (!syncResult.success) throw new Error('Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚');
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ performance
                            if (duration > 10000) { // 10 seconds
                                throw new Error(`Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¨Ø³ÛŒØ§Ø± Ú©Ù†Ø¯: ${duration.toFixed(0)}ms`);
                            }
                            
                            const syncState = api.getSyncState();
                            
                            return `âœ… Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ${batchSize} Ø¢ÛŒØªÙ… Ø¯Ø± ${duration.toFixed(0)}ms. ØªØ¯Ø§Ø®Ù„: ${syncResult.conflicts}`;
                        }
                    }
                ]
            },
            {
                id: 'api-security',
                name: 'Ø§Ù…Ù†ÛŒØª API',
                icon: 'ğŸ›¡ï¸',
                tests: [
                    {
                        id: 'api-token-refresh',
                        name: 'ØªØ§Ø²Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© Token',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ refresh Ø®ÙˆØ¯Ú©Ø§Ø± tokenÙ‡Ø§ÛŒ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡',
                        network: false,
                        security: true,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // ØªÙ†Ø¸ÛŒÙ… token Ù‚Ø¯ÛŒÙ…ÛŒ
                            const oldToken = 'old_token_123';
                            api.setToken(oldToken, 'refresh_token_123');
                            
                            // Ø¯Ø± MockApiClient ÙØ¹Ù„Ø§Ù‹ refresh Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ø´Ø¯Ù‡
                            // Ø§ÛŒÙ† ØªØ³Øª Ù…Ù†Ø·Ù‚ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
                            const hasRefreshLogic = api.refreshToken !== null;
                            const hasAuthHeader = api.headers['Authorization'] !== undefined;
                            
                            if (!hasRefreshLogic) {
                                throw new Error('Ø³ÛŒØ³ØªÙ… refresh token Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ø´Ø¯Ù‡');
                            }
                            
                            if (!hasAuthHeader) {
                                throw new Error('Header Authorization ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯');
                            }
                            
                            return 'âœ… Ø³ÛŒØ³ØªÙ… token Ùˆ refresh Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯';
                        }
                    },
                    {
                        id: 'api-security-headers',
                        name: 'Security Headers',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ headers Ø§Ù…Ù†ÛŒØªÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ',
                        network: false,
                        security: true,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ headers Ù¾Ø§ÛŒÙ‡
                            const requiredHeaders = ['Content-Type', 'Accept', 'X-App-Version', 'X-Platform'];
                            const missingHeaders = [];
                            
                            for (const header of requiredHeaders) {
                                if (!api.headers[header]) {
                                    missingHeaders.push(header);
                                }
                            }
                            
                            if (missingHeaders.length > 0) {
                                throw new Error(`Headers Ø¶Ø±ÙˆØ±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ù†Ø¯: ${missingHeaders.join(', ')}`);
                            }
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ù‚Ø¯Ø§Ø± headers
                            if (api.headers['Content-Type'] !== 'application/json') {
                                throw new Error('Content-Type Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª');
                            }
                            
                            if (api.headers['Accept'] !== 'application/json') {
                                throw new Error('Accept Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª');
                            }
                            
                            return 'âœ… Security headers Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯';
                        }
                    },
                    {
                        id: 'api-data-sanitization',
                        name: 'Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¯Ù… Ù„Ùˆ Ø±ÙØªÙ† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³ Ø¯Ø± logs',
                        network: false,
                        security: true,
                        run: async () => {
                            // ØªØ³Øª logger
                            const logger = new NetworkLogger();
                            
                            // log Ø¯Ø§Ø¯Ù‡ Ø­Ø³Ø§Ø³
                            const sensitiveData = {
                                password: 'MySecretPassword123',
                                token: 'secret_jwt_token_here',
                                creditCard: '4111111111111111',
                                normalField: 'public data'
                            };
                            
                            const logged = logger.logRequest('POST', '/api/login', 200, 150, sensitiveData);
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ redacted Ø´Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³
                            if (logged.data.password !== '***REDACTED***') {
                                throw new Error('Password redacted Ù†Ø´Ø¯');
                            }
                            
                            if (logged.data.token !== '***REDACTED***') {
                                throw new Error('Token redacted Ù†Ø´Ø¯');
                            }
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ø­Ø³Ø§Ø³
                            if (logged.data.normalField !== 'public data') {
                                throw new Error('Ø¯Ø§Ø¯Ù‡ ØºÛŒØ±Ø­Ø³Ø§Ø³ Ø¨Ø§ÛŒØ¯ Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯');
                            }
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ credit card (Ú©Ù‡ Ø¯Ø± Ù„ÛŒØ³Øª Ø­Ø³Ø§Ø³ Ù†ÛŒØ³Øª ÙˆÙ„ÛŒ Ø¨Ø§ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯)
                            if (logged.data.creditCard === sensitiveData.creditCard) {
                                console.warn('Credit card number redacted Ù†Ø´Ø¯ - Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ù„ÛŒØ³Øª sensitiveFields Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯');
                            }
                            
                            return 'âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ redacted Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯';
                        }
                    },
                    {
                        id: 'api-rate-limiting',
                        name: 'Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù†Ø±Ø® Ø¯Ø±Ø®ÙˆØ§Ø³Øª',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯',
                        network: true,
                        security: true,
                        run: async () => {
                            const api = new MockApiClient();
                            let rateLimitError = false;
                            
                            // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ØªÙˆØ§Ù„ÛŒ
                            for (let i = 0; i < 15; i++) {
                                const result = await api.get('/api/users/me');
                                
                                // Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø·Ø§ÛŒ 429 (Too Many Requests)
                                if (result.status === 429) {
                                    rateLimitError = true;
                                    break;
                                }
                            }
                            
                            // Ø¯Ø± Mock ÙØ¹Ù„ÛŒ rate limiting Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ø´Ø¯Ù‡
                            // Ø§ÛŒÙ† ØªØ³Øª Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
                            if (!rateLimitError) {
                                return 'âš ï¸ Rate limiting Ø¯Ø± mock Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ø´Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª)';
                            }
                            
                            return 'âœ… Ø³ÛŒØ³ØªÙ… rate limiting ÙØ¹Ø§Ù„ Ø§Ø³Øª';
                        }
                    }
                ]
            },
            {
                id: 'api-performance',
                name: 'ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯',
                icon: 'âš¡',
                tests: [
                    {
                        id: 'api-parallel-requests',
                        name: 'Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ§Ø²ÛŒ',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù†',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            const concurrentRequests = 10;
                            
                            const startTime = performance.now();
                            
                            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ§Ø²ÛŒ
                            const promises = [];
                            for (let i = 0; i < concurrentRequests; i++) {
                                promises.push(
                                    api.get('/api/users/me')
                                );
                            }
                            
                            const results = await Promise.allSettled(promises);
                            const duration = performance.now() - startTime;
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ Ù†ØªØ§ÛŒØ¬
                            const successful = results.filter(r => 
                                r.status === 'fulfilled' && r.value.success
                            ).length;
                            
                            const failed = results.filter(r => 
                                r.status === 'rejected' || (r.status === 'fulfilled' && !r.value.success)
                            ).length;
                            
                            if (failed > concurrentRequests * 0.3) { // Ø¨ÛŒØ´ Ø§Ø² 30% Ø®Ø·Ø§
                                throw new Error(`Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ§Ø²ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${failed} Ø§Ø² ${concurrentRequests}`);
                            }
                            
                            const avgRequestTime = duration / concurrentRequests;
                            
                            return `âœ… ${concurrentRequests} Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ÙˆØ§Ø²ÛŒ Ø¯Ø± ${duration.toFixed(0)}ms (Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†: ${avgRequestTime.toFixed(0)}ms)`;
                        }
                    },
                    {
                        id: 'api-cache-performance',
                        name: 'Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú©Ø´',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ ØªØ£Ø«ÛŒØ± Ú©Ø´ Ø¨Ø± Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®â€ŒÚ¯ÙˆÛŒÛŒ',
                        network: false,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            const testEndpoint = '/api/users/me';
                            
                            // Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª (Ø¨Ø¯ÙˆÙ† Ú©Ø´)
                            const startTime1 = performance.now();
                            const result1 = await api.get(testEndpoint);
                            const duration1 = performance.now() - startTime1;
                            
                            if (!result1.success) throw new Error('Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù†Ø§Ù…ÙˆÙÙ‚');
                            
                            // Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø¹Ø¯ÛŒ (Ø§Ú¯Ø± Ú©Ø´ Ø¯Ø§Ø´ØªÛŒÙ…)
                            const durations = [];
                            for (let i = 0; i < 5; i++) {
                                const start = performance.now();
                                await api.get(testEndpoint);
                                durations.push(performance.now() - start);
                            }
                            
                            const avgDuration = durations.reduce((a, b) => a + b, 0) / durations.length;
                            
                            // Ø¯Ø± mock ÙØ¹Ù„ÛŒ Ú©Ø´ Ù†Ø¯Ø§Ø±ÛŒÙ…ØŒ ÙÙ‚Ø· times Ø±Ø§ Ú¯Ø²Ø§Ø±Ø´ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                            if (avgDuration >= duration1) {
                                return `â±ï¸ Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù¾Ø§Ø³Ø®: Ø§ÙˆÙ„ÛŒÙ† ${duration1.toFixed(0)}ms, Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¨Ø¹Ø¯ÛŒ ${avgDuration.toFixed(0)}ms (Ú©Ø´ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª)`;
                            }
                            
                            return `âœ… Ú©Ø´ Ù…Ø¤Ø«Ø± Ø§Ø³Øª: Ø§ÙˆÙ„ÛŒÙ† ${duration1.toFixed(0)}ms â†’ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† ${avgDuration.toFixed(0)}ms`;
                        }
                    },
                    {
                        id: 'api-large-payload',
                        name: 'Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø¬ÛŒÙ…',
                        description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø§ payloadÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯',
                        network: true,
                        security: false,
                        run: async () => {
                            const api = new MockApiClient();
                            
                            // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø¯Ù‡ Ø­Ø¬ÛŒÙ…
                            const largeData = {
                                items: []
                            };
                            
                            // 100 Ø¢ÛŒØªÙ… Ø¨Ø§ Ø¯Ø§Ø¯Ù‡ Ù†Ø³Ø¨ØªØ§Ù‹ Ø¨Ø²Ø±Ú¯
                            for (let i = 0; i < 100; i++) {
                                largeData.items.push({
                                    id: `item_${i}`,
                                    name: 'Ø¢ÛŒØªÙ… ØªØ³ØªÛŒ Ø¨Ø§ Ù†Ø§Ù… Ù†Ø³Ø¨ØªØ§Ù‹ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯',
                                    description: 'Ø§ÛŒÙ† ÛŒÚ© ØªÙˆØ¶ÛŒØ­ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø­Ø¬Ù… Ø¯Ø§Ø¯Ù‡ Ø±Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯. '.repeat(10),
                                    metadata: {
                                        created: new Date().toISOString(),
                                        updated: new Date().toISOString(),
                                        tags: ['tag1', 'tag2', 'tag3', 'tag4', 'tag5'],
                                        scores: Array.from({ length: 20 }, () => Math.random())
                                    },
                                    content: 'Ù…Ø­ØªÙˆØ§'.repeat(50)
                                });
                            }
                            
                            const startTime = performance.now();
                            const result = await api.post('/api/lessons/sync', {
                                changes: largeData.items
                            });
                            const duration = performance.now() - startTime;
                            
                            if (!result.success) throw new Error('Ø§Ø±Ø³Ø§Ù„ Ø¯Ø§Ø¯Ù‡ Ø­Ø¬ÛŒÙ… Ù†Ø§Ù…ÙˆÙÙ‚');
                            
                            // ØªØ®Ù…ÛŒÙ† Ø­Ø¬Ù… Ø¯Ø§Ø¯Ù‡ (ØªÙ‚Ø±ÛŒØ¨ÛŒ)
                            const estimatedSize = JSON.stringify(largeData).length;
                            const sizeKB = (estimatedSize / 1024).toFixed(1);
                            
                            if (duration > 5000) { // 5 seconds
                                throw new Error(`Ø§Ø±Ø³Ø§Ù„ Ø¯Ø§Ø¯Ù‡ Ø­Ø¬ÛŒÙ… Ø¨Ø³ÛŒØ§Ø± Ú©Ù†Ø¯: ${duration.toFixed(0)}ms`);
                            }
                            
                            return `âœ… Ø§Ø±Ø³Ø§Ù„ ${sizeKB}KB Ø¯Ø§Ø¯Ù‡ Ø¯Ø± ${duration.toFixed(0)}ms`;
                        }
                    }
                ]
            }
        ];

        // ============ Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª ØªØ³Øªâ€ŒÙ‡Ø§ ============
        class ApiTestManager {
            constructor() {
                this.logger = new NetworkLogger();
                this.apiClient = new MockApiClient();
                this.results = new Map();
                this.totalTests = 0;
                this.completedTests = 0;
                this.networkTests = 0;
                this.securityTests = 0;
                this.requestCount = 0;
                
                this.calculateStats();
                this.renderTests();
                this.setupEventListeners();
                this.updateDisplay();
                this.initializeSimulator();
            }
            
            calculateStats() {
                this.totalTests = API_TEST_SUITES.reduce(
                    (sum, suite) => sum + suite.tests.length, 0
                );
                
                this.networkTests = API_TEST_SUITES.reduce(
                    (sum, suite) => sum + suite.tests.filter(t => t.network).length, 0
                );
                
                this.securityTests = API_TEST_SUITES.reduce(
                    (sum, suite) => sum + suite.tests.filter(t => t.security).length, 0
                );
            }
            
            renderTests() {
                const container = document.getElementById('test-container');
                container.innerHTML = '';
                
                API_TEST_SUITES.forEach(suite => {
                    const section = document.createElement('div');
                    section.className = 'test-section';
                    section.innerHTML = `
                        <h2><span>${suite.icon}</span> ${suite.name}</h2>
                        <div id="suite-${suite.id}">
                            ${suite.tests.map(test => `
                                <div class="test-item ${test.network ? 'network' : ''}" id="test-${test.id}">
                                    <div class="test-header">
                                        <div class="test-title">
                                            ${test.name}
                                            ${test.network ? '<span class="test-network">Ø´Ø¨Ú©Ù‡</span>' : ''}
                                            ${test.security ? '<span style="background: #8b5cf6; color: white; padding: 2px 8px; border-radius: 10px; margin-right: 10px; font-size: 0.8rem;">Ø§Ù…Ù†ÛŒØªÛŒ</span>' : ''}
                                        </div>
                                        <div class="test-status status-pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 8px;">
                                        ${test.description}
                                    </div>
                                    <div class="test-output" id="output-${test.id}" style="display: none;"></div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(section);
                });
            }
            
            setupEventListeners() {
                document.getElementById('run-tests').addEventListener('click', () => {
                    this.runAllTests();
                });
                
                document.getElementById('run-network').addEventListener('click', () => {
                    this.runNetworkTests();
                });
                
                document.getElementById('run-sync').addEventListener('click', () => {
                    this.runSyncTests();
                });
                
                document.getElementById('run-security').addEventListener('click', () => {
                    this.runSecurityTests();
                });
                
                document.getElementById('clear-results').addEventListener('click', () => {
                    if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
                        this.clearResults();
                    }
                });
                
                document.getElementById('export-results').addEventListener('click', () => {
                    this.exportResults();
                });
            }
            
            async runAllTests() {
                const runButton = document.getElementById('run-tests');
                runButton.disabled = true;
                runButton.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
                
                this.logger.logSecurity('Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… API Ùˆ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ');
                
                for (const suite of API_TEST_SUITES) {
                    this.logger.logRequest('TEST_SUITE', `Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ${suite.name}`, 200, 0);
                    for (const test of suite.tests) {
                        await this.runSingleTest(test);
                    }
                }
                
                runButton.disabled = false;
                runButton.innerHTML = '<span>ğŸš€</span> Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¬Ø¯Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§';
                
                this.showSummary();
                this.updateMetrics();
            }
            
            async runNetworkTests() {
                const networkButton = document.getElementById('run-network');
                networkButton.disabled = true;
                networkButton.innerHTML = '<span class="loading"></span> ØªØ³Øª Ø´Ø¨Ú©Ù‡...';
                
                this.logger.logSecurity('Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡ ÙˆÛŒÚ˜Ù‡');
                
                for (const suite of API_TEST_SUITES) {
                    for (const test of suite.tests.filter(t => t.network)) {
                        await this.runSingleTest(test);
                    }
                }
                
                networkButton.disabled = false;
                networkButton.innerHTML = '<span>ğŸŒ</span> ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡';
                
                this.updateMetrics();
            }
            
            async runSyncTests() {
                const syncButton = document.getElementById('run-sync');
                syncButton.disabled = true;
                syncButton.innerHTML = '<span class="loading"></span> ØªØ³Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ...';
                
                this.logger.logSecurity('Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ');
                
                const syncSuite = API_TEST_SUITES.find(s => s.id === 'api-sync');
                if (syncSuite) {
                    for (const test of syncSuite.tests) {
                        await this.runSingleTest(test);
                    }
                }
                
                syncButton.disabled = false;
                syncButton.innerHTML = '<span>ğŸ”„</span> ØªØ³Øª Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ';
                
                this.updateMetrics();
                this.updateSyncVisualizer();
            }
            
            async runSecurityTests() {
                const securityButton = document.getElementById('run-security');
                securityButton.disabled = true;
                securityButton.innerHTML = '<span class="loading"></span> ØªØ³Øª Ø§Ù…Ù†ÛŒØªÛŒ...';
                
                this.logger.logSecurity('Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ ÙˆÛŒÚ˜Ù‡');
                
                for (const suite of API_TEST_SUITES) {
                    for (const test of suite.tests.filter(t => t.security)) {
                        await this.runSingleTest(test);
                    }
                }
                
                securityButton.disabled = false;
                securityButton.innerHTML = '<span>ğŸ›¡ï¸</span> ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ';
                
                this.updateMetrics();
            }
            
            async runSingleTest(test) {
                const testElement = document.getElementById(`test-${test.id}`);
                const statusElement = testElement.querySelector('.test-status');
                const outputElement = document.getElementById(`output-${test.id}`);
                
                // Ø±ÛŒØ³Øª ÙˆØ¶Ø¹ÛŒØª
                testElement.className = `test-item ${test.network ? 'network' : ''}`;
                statusElement.className = 'test-status status-pending';
                statusElement.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
                outputElement.style.display = 'none';
                
                try {
                    const startTime = performance.now();
                    const result = await test.run();
                    const duration = performance.now() - startTime;
                    
                    // Ù…ÙˆÙÙ‚
                    testElement.classList.add('passed');
                    statusElement.className = 'test-status status-passed';
                    statusElement.textContent = `Ù…ÙˆÙÙ‚ (${duration.toFixed(0)}ms)`;
                    outputElement.textContent = result;
                    outputElement.className = 'test-output success';
                    outputElement.style.display = 'block';
                    
                    this.results.set(test.id, { 
                        success: true, 
                        result,
                        duration,
                        network: test.network,
                        security: test.security
                    });
                    
                    if (test.security) {
                        this.logger.logSecurity(`ØªØ³Øª Ø§Ù…Ù†ÛŒØªÛŒ "${test.name}" Ù…ÙˆÙÙ‚`, { duration: `${duration.toFixed(0)}ms` });
                    } else if (test.network) {
                        this.logger.logRequest('TEST', test.name, 200, duration);
                    } else {
                        this.logger.logRequest('TEST', test.name, 200, duration);
                    }
                    
                } catch (error) {
                    // Ø´Ú©Ø³Øª
                    testElement.classList.add('failed');
                    statusElement.className = 'test-status status-failed';
                    statusElement.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                    outputElement.textContent = `Ø®Ø·Ø§: ${error.message}\n${error.stack || ''}`;
                    outputElement.className = 'test-output error';
                    outputElement.style.display = 'block';
                    
                    this.results.set(test.id, { 
                        success: false, 
                        error: error.message,
                        network: test.network,
                        security: test.security
                    });
                    
                    this.logger.logError(`ØªØ³Øª "${test.name}" Ù†Ø§Ù…ÙˆÙÙ‚`, error);
                }
                
                this.completedTests++;
                this.updateDisplay();
                this.updateMetrics();
                this.updateRequestLog();
            }
            
            updateDisplay() {
                const passed = Array.from(this.results.values()).filter(r => r.success).length;
                const failed = Array.from(this.results.values()).filter(r => !r.success).length;
                const networkPassed = Array.from(this.results.values())
                    .filter(r => r.network && r.success).length;
                const securityPassed = Array.from(this.results.values())
                    .filter(r => r.security && r.success).length;
                const pending = this.totalTests - this.completedTests;
                
                document.getElementById('passed-count').textContent = passed;
                document.getElementById('failed-count').textContent = failed;
                document.getElementById('network-count').textContent = networkPassed;
                document.getElementById('security-count').textContent = securityPassed;
                document.getElementById('request-count').textContent = this.requestCount;
                document.getElementById('pending-count').textContent = pending;
            }
            
            updateMetrics() {
                const metrics = this.logger.getMetrics();
                
                document.getElementById('avg-response').textContent = 
                    `${metrics.avgResponse.toFixed(0)}ms`;
                document.getElementById('success-rate').textContent = 
                    `${metrics.successRate.toFixed(1)}%`;
                document.getElementById('queue-size').textContent = 
                    this.apiClient.offlineQueue.length;
                
                this.requestCount = metrics.totalRequests;
                this.updateDisplay();
            }
            
            updateRequestLog() {
                const logContainer = document.getElementById('request-log');
                const recentLogs = this.logger.requests.slice(-10).reverse();
                
                logContainer.innerHTML = recentLogs.map(log => {
                    const statusClass = log.status >= 400 ? 'log-error' : 
                                      log.status >= 300 ? 'log-warning' : 'log-success';
                    
                    return `
                        <div class="log-entry ${statusClass}">
                            [${log.time}] ${log.method} ${log.url} â†’ ${log.status} (${log.duration.toFixed(0)}ms)
                        </div>
                    `;
                }).join('');
            }
            
            clearResults() {
                this.results.clear();
                this.completedTests = 0;
                this.logger.clear();
                this.apiClient = new MockApiClient();
                
                this.renderTests();
                this.updateDisplay();
                this.updateMetrics();
                this.updateRequestLog();
                this.updateSyncVisualizer();
                this.updateNetworkStatus();
                
                this.logger.logSecurity('Ù†ØªØ§ÛŒØ¬ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯');
                document.getElementById('current-operation').textContent = 'Ù‡ÛŒÚ† Ø¹Ù…Ù„ÛŒØ§ØªÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡';
            }
            
            exportResults() {
                const results = {
                    timestamp: new Date().toISOString(),
                    system: 'API Client & Sync System',
                    totalTests: this.totalTests,
                    completedTests: this.completedTests,
                    networkTests: this.networkTests,
                    securityTests: this.securityTests,
                    results: Object.fromEntries(this.results),
                    logs: this.logger.logs,
                    metrics: this.logger.getMetrics(),
                    syncState: this.apiClient.getSyncState(),
                    offlineQueue: this.apiClient.offlineQueue.length
                };
                
                const dataStr = JSON.stringify(results, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `vakamova-api-test-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                this.logger.logSecurity('Ù†ØªØ§ÛŒØ¬ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
            }
            
            showSummary() {
                const passed = Array.from(this.results.values()).filter(r => r.success).length;
                const failed = this.completedTests - passed;
                const networkPassed = Array.from(this.results.values())
                    .filter(r => r.network && r.success).length;
                const securityPassed = Array.from(this.results.values())
                    .filter(r => r.security && r.success).length;
                const successRate = ((passed / this.totalTests) * 100).toFixed(1);
                
                const metrics = this.logger.getMetrics();
                
                const summary = `
ğŸ¯ Ø®Ù„Ø§ØµÙ‡ Ù†ØªØ§ÛŒØ¬ ØªØ³Øª API Ùˆ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ:
âœ… Ù…ÙˆÙÙ‚: ${passed} Ø§Ø² ${this.totalTests}
âŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${failed}
ğŸŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡: ${networkPassed} Ø§Ø² ${this.networkTests}
ğŸ›¡ï¸ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ: ${securityPassed} Ø§Ø² ${this.securityTests}
ğŸ“Š Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª: ${successRate}%
â±ï¸ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®: ${metrics.avgResponse.toFixed(0)}ms
ğŸ“¡ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ù„: ${metrics.totalRequests}
                `.trim();
                
                this.logger.logSecurity(summary);
                
                // Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ù„Ø§Ù†
                if (failed === 0 && networkPassed === this.networkTests && securityPassed === this.securityTests) {
                    alert(`ğŸ‰ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ø§Ù…Ù„!\n${summary}`);
                } else if (failed > 0) {
                    alert(`âš ï¸ ${failed} ØªØ³Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¯Ø§Ø´ØªÛŒÙ….\n${summary}`);
                }
            }
            
            // ============ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² ============
            
            initializeSimulator() {
                this.updateNetworkStatus();
                this.updateSyncVisualizer();
                this.updateMetrics();
            }
            
            updateNetworkStatus() {
                const isOnline = this.apiClient.isOnline;
                const speed = this.apiClient.networkSpeed;
                
                const statusElement = document.getElementById('network-status');
                const textElement = document.getElementById('network-status-text');
                
                if (!isOnline) {
                    statusElement.className = 'status-indicator status-offline';
                    textElement.textContent = 'Ø¢ÙÙ„Ø§ÛŒÙ†';
                } else {
                    statusElement.className = 'status-indicator status-online';
                    
                    switch (speed) {
                        case 'very-slow':
                            textElement.textContent = 'Ø¢Ù†Ù„Ø§ÛŒÙ† - Ø³Ø±Ø¹Øª Ø¨Ø³ÛŒØ§Ø± Ú©Ù†Ø¯';
                            statusElement.className = 'status-indicator status-slow';
                            break;
                        case 'slow':
                            textElement.textContent = 'Ø¢Ù†Ù„Ø§ÛŒÙ† - Ø³Ø±Ø¹Øª Ú©Ù†Ø¯';
                            statusElement.className = 'status-indicator status-slow';
                            break;
                        default:
                            textElement.textContent = 'Ø¢Ù†Ù„Ø§ÛŒÙ† - Ø³Ø±Ø¹Øª Ø¹Ø§Ø¯ÛŒ';
                            break;
                    }
                }
            }
            
            updateSyncVisualizer() {
                const syncState = this.apiClient.getSyncState();
                
                document.getElementById('local-data').textContent = syncState.localData;
                document.getElementById('server-data').textContent = syncState.serverData;
                document.getElementById('pending-sync').textContent = syncState.pendingSync;
                document.getElementById('conflicts').textContent = syncState.conflicts;
            }
            
            async simulateApiCall(method, path) {
                const startTime = performance.now();
                
                document.getElementById('current-operation').textContent = 
                    `${method} ${path} ...`;
                
                try {
                    let result;
                    
                    switch (method) {
                        case 'GET':
                            result = await this.apiClient.get(path);
                            break;
                        case 'POST':
                            result = await this.apiClient.post(path, { 
                                simulated: true,
                                timestamp: new Date().toISOString()
                            });
                            break;
                        case 'PUT':
                            result = await this.apiClient.put(path, {
                                updated: true,
                                timestamp: new Date().toISOString()
                            });
                            break;
                        case 'DELETE':
                            result = await this.apiClient.delete(path);
                            break;
                        default:
                            throw new Error(`Ù…ØªØ¯ ${method} Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯`);
                    }
                    
                    const duration = performance.now() - startTime;
                    
                    if (result.success) {
                        this.logger.logRequest(method, path, result.status || 200, duration, result.data);
                        
                        document.getElementById('current-operation').textContent = 
                            `${method} ${path} â†’ Ù…ÙˆÙÙ‚ (${duration.toFixed(0)}ms)`;
                    } else {
                        this.logger.logRequest(method, path, result.status || 0, duration, {
                            error: result.error
                        });
                        
                        document.getElementById('current-operation').textContent = 
                            `${method} ${path} â†’ Ø®Ø·Ø§: ${result.error} (${duration.toFixed(0)}ms)`;
                    }
                    
                } catch (error) {
                    const duration = performance.now() - startTime;
                    this.logger.logError(`Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ${method} ${path}`, error);
                    
                    document.getElementById('current-operation').textContent = 
                        `${method} ${path} â†’ Ø®Ø·Ø§: ${error.message} (${duration.toFixed(0)}ms)`;
                }
                
                this.updateMetrics();
                this.updateRequestLog();
            }
            
            async simulateSync() {
                document.getElementById('current-operation').textContent = 
                    'Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ...';
                
                try {
                    const changes = Array.from({ length: 5 }, (_, i) => ({
                        id: `sync_${Date.now()}_${i}`,
                        type: 'progress',
                        value: Math.floor(Math.random() * 100),
                        timestamp: Date.now() - i * 1000
                    }));
                    
                    const result = await this.apiClient.syncData(changes);
                    
                    if (result.success) {
                        document.getElementById('current-operation').textContent = 
                            `Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù…ÙˆÙÙ‚: ${result.synced} Ø¢ÛŒØªÙ…, ${result.conflicts} ØªØ¯Ø§Ø®Ù„`;
                    } else {
                        document.getElementById('current-operation').textContent = 
                            `Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${result.error}`;
                    }
                    
                    this.logger.logSync('manual_sync', 
                        result.state?.localData || 0,
                        result.state?.serverData || 0,
                        result.conflicts || 0);
                    
                } catch (error) {
                    document.getElementById('current-operation').textContent = 
                        `Ø®Ø·Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ: ${error.message}`;
                    this.logger.logError('Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ', error);
                }
                
                this.updateSyncVisualizer();
                this.updateMetrics();
            }
            
            simulateOfflineQueue() {
                const queueSize = this.apiClient.offlineQueue.length;
                
                if (queueSize > 0) {
                    const processed = this.apiClient.processOfflineQueue();
                    
                    document.getElementById('current-operation').textContent = 
                        `Ù¾Ø±Ø¯Ø§Ø²Ø´ ØµÙ Ø¢ÙÙ„Ø§ÛŒÙ†: ${processed.processed} Ø¢ÛŒØªÙ… Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯`;
                    
                    this.logger.logRequest('QUEUE', 'process_offline_queue', 200, 0, {
                        processed: processed.processed,
                        failed: processed.failed
                    });
                } else {
                    document.getElementById('current-operation').textContent = 
                        'ØµÙ Ø¢ÙÙ„Ø§ÛŒÙ† Ø®Ø§Ù„ÛŒ Ø§Ø³Øª';
                }
                
                this.updateMetrics();
                this.updateSyncVisualizer();
            }
            
            async simulateConflict() {
                document.getElementById('current-operation').textContent = 
                    'Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ¯Ø§Ø®Ù„ Ø¯Ø§Ø¯Ù‡ ...';
                
                // Ø§ÛŒØ¬Ø§Ø¯ ØªØºÛŒÛŒØ±Ø§ØªÛŒ Ú©Ù‡ Ø§Ø­ØªÙ…Ø§Ù„ ØªØ¯Ø§Ø®Ù„ Ø¯Ø§Ø±Ù†Ø¯
                const conflictingChanges = [
                    {
                        id: 'conflict_1',
                        type: 'lesson',
                        version: 1,
                        localValue: 'Ù…Ù‚Ø¯Ø§Ø± Ù…Ø­Ù„ÛŒ',
                        serverValue: 'Ù…Ù‚Ø¯Ø§Ø± Ø³Ø±ÙˆØ±',
                        timestamp: Date.now() - 5000
                    },
                    {
                        id: 'conflict_2',
                        type: 'progress',
                        localValue: 75,
                        serverValue: 50,
                        timestamp: Date.now() - 3000
                    }
                ];
                
                try {
                    const result = await this.apiClient.syncData(conflictingChanges);
                    
                    document.getElementById('current-operation').textContent = 
                        `ØªØ¯Ø§Ø®Ù„ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡: ${result.conflicts || 0} ØªØ¯Ø§Ø®Ù„ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯`;
                    
                    this.logger.logSync('conflict_simulation', 
                        result.state?.localData || 0,
                        result.state?.serverData || 0,
                        result.conflicts || 0);
                    
                } catch (error) {
                    document.getElementById('current-operation').textContent = 
                        `Ø®Ø·Ø§ÛŒ ØªØ¯Ø§Ø®Ù„: ${error.message}`;
                }
                
                this.updateSyncVisualizer();
                this.updateMetrics();
            }
            
            toggleNetwork() {
                const isOnline = this.apiClient.isOnline;
                const speeds = ['normal', 'slow', 'very-slow'];
                
                if (isOnline) {
                    // Ø±ÙØªÙ† Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†
                    this.apiClient.setNetworkStatus(false);
                } else {
                    // Ø±ÙØªÙ† Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¢Ù†Ù„Ø§ÛŒÙ† Ø¨Ø§ Ø³Ø±Ø¹Øª ØªØµØ§Ø¯ÙÛŒ
                    const randomSpeed = speeds[Math.floor(Math.random() * speeds.length)];
                    this.apiClient.setNetworkStatus(true, randomSpeed);
                }
                
                this.updateNetworkStatus();
                document.getElementById('current-operation').textContent = 
                    `ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø´Ø¨Ú©Ù‡: ${this.apiClient.isOnline ? 'Ø¢Ù†Ù„Ø§ÛŒÙ†' : 'Ø¢ÙÙ„Ø§ÛŒÙ†'}`;
            }
            
            async forceFullSync() {
                document.getElementById('current-operation').textContent = 
                    'Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ ...';
                
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ sync Ú©Ø§Ù…Ù„
                const fakeChanges = Array.from({ length: 25 }, (_, i) => ({
                    id: `fullsync_${Date.now()}_${i}`,
                    type: 'full_sync',
                    timestamp: Date.now() - i * 1000
                }));
                
                try {
                    const result = await this.apiClient.syncData(fakeChanges);
                    
                    document.getElementById('current-operation').textContent = 
                        `Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„: ${result.synced || 0} Ø¢ÛŒØªÙ… Ù‡Ù…Ú¯Ø§Ù… Ø´Ø¯`;
                    
                    this.logger.logSync('force_full_sync', 
                        result.state?.localData || 0,
                        result.state?.serverData || 0,
                        result.conflicts || 0);
                    
                } catch (error) {
                    document.getElementById('current-operation').textContent = 
                        `Ø®Ø·Ø§ÛŒ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„: ${error.message}`;
                }
                
                this.updateSyncVisualizer();
                this.updateMetrics();
            }
            
            clearSyncData() {
                const cleared = this.apiClient.clearOfflineQueue();
                this.apiClient.updateSyncState({
                    localData: 0,
                    serverData: 0,
                    pendingSync: 0,
                    conflicts: 0
                });
                
                document.getElementById('current-operation').textContent = 
                    `Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡: ${cleared} Ø¢ÛŒØªÙ… Ø§Ø² ØµÙ Ø­Ø°Ù Ø´Ø¯`;
                
                this.updateSyncVisualizer();
                this.updateMetrics();
            }
            
            async simulateRealtime() {
                document.getElementById('current-operation').textContent = 
                    'Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Real-time updates ...';
                
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú†Ù†Ø¯ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ø±ÛŒØ¹
                for (let i = 0; i < 3; i++) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    const change = {
                        id: `realtime_${Date.now()}_${i}`,
                        type: 'realtime_update',
                        value: Math.random(),
                        timestamp: Date.now()
                    };
                    
                    try {
                        await this.apiClient.syncData([change]);
                        this.logger.logRequest('WS', 'realtime_update', 200, 50, change);
                    } catch (error) {
                        // ignore errors in simulation
                    }
                }
                
                document.getElementById('current-operation').textContent = 
                    'Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Real-time Ú©Ø§Ù…Ù„ Ø´Ø¯';
                
                this.updateSyncVisualizer();
                this.updateMetrics();
            }
        }

        // ============ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ùˆ ØªÙˆØ§Ø¨Ø¹ Ø¹Ù…ÙˆÙ…ÛŒ ============
        let apiTestManager;

        document.addEventListener('DOMContentLoaded', () => {
            apiTestManager = new ApiTestManager();
            console.log('âœ… Ø³ÛŒØ³ØªÙ… ØªØ³Øª API Ùˆ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Vakamova Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
        });

        // ØªÙˆØ§Ø¨Ø¹ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ HTML
        window.simulateApiCall = (method, path) => apiTestManager.simulateApiCall(method, path);
        window.simulateSync = () => apiTestManager.simulateSync();
        window.simulateOfflineQueue = () => apiTestManager.simulateOfflineQueue();
        window.simulateConflict = () => apiTestManager.simulateConflict();
        window.toggleNetwork = () => apiTestManager.toggleNetwork();
        window.forceFullSync = () => apiTestManager.forceFullSync();
        window.clearSyncData = () => apiTestManager.clearSyncData();
        window.simulateRealtime = () => apiTestManager.simulateRealtime();
    </script>
</body>
    </html>
