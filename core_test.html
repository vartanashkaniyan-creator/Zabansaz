<!DOCTYPE html>
<html dir="rtl">
<head>
    <title>ØªØ³Øª Ù…Ø§Ú˜ÙˆÙ„ Core</title>
    <style>
        body { font-family: Tahoma; margin: 20px; }
        button { padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; margin: 5px; }
        .result { padding: 10px; margin: 5px 0; border-right: 4px solid; }
        .success { background: #E8F5E9; border-color: #4CAF50; }
        .error { background: #FFEBEE; border-color: #F44336; }
        .warning { background: #FFF3E0; border-color: #FF9800; }
    </style>
</head>
<body>
    <h2>âš™ï¸ ØªØ³Øª Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Core</h2>
    <button onclick="testEventBus()">ØªØ³Øª Event Bus</button>
    <button onclick="testDatabase()">ØªØ³Øª Database</button>
    <button onclick="testAll()">ØªØ³Øª Ú©Ø§Ù…Ù„ Core</button>
    <div id="results"></div>

    <!-- ÙÙ‚Ø· ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ core -->
    <script src="core/utils.js"></script>
    <script src="core/event_bus.js"></script>
    <script src="core/state_manager.js"></script>
    <script src="core/db.js"></script>
    <script src="core/router.js"></script>

    <script>
        const results = document.getElementById('results');
        
        function showResult(module, message, type = 'success') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${module}:</strong> ${message}`;
            results.appendChild(div);
        }

        function testEventBus() {
            results.innerHTML = '<h3>ğŸ“¡ ØªØ³Øª Event Bus</h3>';
            
            // Ø±ÙˆØ´ Û±: Ø¨Ø±Ø±Ø³ÛŒ global
            if (typeof window.eventBus !== 'undefined') {
                showResult('event_bus.js', 'âœ… ÙØ§ÛŒÙ„ Ù„ÙˆØ¯ Ø´Ø¯ (eventBus)', 'success');
                
                try {
                    // ØªØ³Øª Ø¹Ù…Ù„ÛŒØ§ØªÛŒ
                    let received = false;
                    eventBus.on('core-test', (data) => {
                        if (data.message === 'hello') received = true;
                    });
                    
                    eventBus.emit('core-test', { message: 'hello' });
                    
                    setTimeout(() => {
                        if (received) {
                            showResult('event_bus.js', 'âœ… Ø§Ø±Ø³Ø§Ù„ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙÙ‚', 'success');
                        } else {
                            showResult('event_bus.js', 'âš ï¸ Ø¯Ø±ÛŒØ§ÙØª Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù†Ø§Ù…ÙˆÙÙ‚', 'warning');
                        }
                    }, 50);
                    
                } catch (error) {
                    showResult('event_bus.js', `âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª: ${error.message}`, 'error');
                }
            } 
            else if (typeof window.HyperEventBus !== 'undefined') {
                showResult('event_bus.js', 'âœ… ÙØ§ÛŒÙ„ Ù„ÙˆØ¯ Ø´Ø¯ (HyperEventBus)', 'success');
            }
            else {
                showResult('event_bus.js', 'âŒ Ù‡ÛŒÚ† Ù…ØªØºÛŒØ± global ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
            }
        }

        function testDatabase() {
            results.innerHTML = '<h3>ğŸ’¾ ØªØ³Øª Database</h3>';
            
            if (typeof window.VakamovaDatabase !== 'undefined') {
                showResult('db.js', 'âœ… ÙØ§ÛŒÙ„ Ù„ÙˆØ¯ Ø´Ø¯ (VakamovaDatabase)', 'success');
                
                try {
                    // ØªØ³Øª Ù†Ù…ÙˆÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ
                    const db = new VakamovaDatabase();
                    showResult('db.js', 'âœ… Ù†Ù…ÙˆÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÙˆÙÙ‚', 'success');
                    
                    // ØªØ³Øª Ù…ØªØ¯Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
                    const methods = ['connect', 'query', 'close'];
                    methods.forEach(method => {
                        if (typeof db[method] === 'function') {
                            showResult('db.js', `âœ… Ù…ØªØ¯ ${method}() Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª`, 'success');
                        } else {
                            showResult('db.js', `âš ï¸ Ù…ØªØ¯ ${method}() ÛŒØ§ÙØª Ù†Ø´Ø¯`, 'warning');
                        }
                    });
                    
                } catch (error) {
                    showResult('db.js', `âŒ Ø®Ø·Ø§ Ø¯Ø± Ù†Ù…ÙˆÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ: ${error.message}`, 'error');
                }
            } 
            else if (typeof window.db !== 'undefined') {
                showResult('db.js', 'âœ… ÙØ§ÛŒÙ„ Ù„ÙˆØ¯ Ø´Ø¯ (db)', 'success');
            }
            else {
                showResult('db.js', 'âŒ Ù‡ÛŒÚ† Ù…ØªØºÛŒØ± global ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
            }
        }

        function testAll() {
            results.innerHTML = '<h3>ğŸ¯ ØªØ³Øª Ú©Ø§Ù…Ù„ Ù…Ø§Ú˜ÙˆÙ„ Core</h3>';
            
            // Ù„ÛŒØ³Øª Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ Ùˆ Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ global Ø¢Ù†Ù‡Ø§
            const modules = [
                { name: 'utils.js', vars: ['utils', 'VakamovaUtils'] },
                { name: 'event_bus.js', vars: ['eventBus', 'HyperEventBus'] },
                { name: 'state_manager.js', vars: ['state_manager', 'stateManager', 'VakamovaState'] },
                { name: 'db.js', vars: ['VakamovaDatabase', 'db'] },
                { name: 'router.js', vars: ['router', 'VakamovaRouter'] }
            ];
            
            modules.forEach(module => {
                let found = false;
                let foundVar = '';
                
                for (const v of module.vars) {
                    if (typeof window[v] !== 'undefined') {
                        found = true;
                        foundVar = v;
                        break;
                    }
                }
                
                if (found) {
                    showResult(module.name, `âœ… Ù„ÙˆØ¯ Ø´Ø¯ (${foundVar})`, 'success');
                } else {
                    showResult(module.name, `âŒ Ù„ÙˆØ¯ Ù†Ø´Ø¯ (Ø¬Ø³ØªØ¬Ùˆ: ${module.vars.join(', ')})`, 'error');
                }
            });
            
            showResult('Ø³ÛŒØ³ØªÙ…', 'âœ… ØªØ³Øª Ú©Ø§Ù…Ù„ core Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 'success');
        }
    </script>
</body>
</html>
