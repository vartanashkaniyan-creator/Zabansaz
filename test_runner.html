<!DOCTYPE html>
<html dir="rtl">
<head>
    <title>ØªØ³Øª EventBus</title>
    <style>
        body { font-family: Tahoma; padding: 20px; }
        button { 
            padding: 10px; 
            margin: 5px; 
            background: blue; 
            color: white; 
            border: none; 
            border-radius: 5px; 
        }
        .success { color: green; }
        .error { color: red; }
        #output { 
            background: #f5f5f5; 
            padding: 15px; 
            margin-top: 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ØªØ³Øª EventBus Ù¾Ø±ÙˆÚ˜Ù‡ Vakamova</h1>
    
    <button onclick="runSimpleTest()">ğŸ¯ ØªØ³Øª Ø³Ø§Ø¯Ù‡</button>
    <button onclick="runAllTests()">ğŸš€ ØªØ³Øª Ú©Ø§Ù…Ù„</button>
    <button onclick="clearOutput()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
    
    <div id="output">Ø§ÛŒÙ†Ø¬Ø§ Ù†ØªØ§ÛŒØ¬ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯...</div>

    <script src="event_bus.js"></script>
    <script>
        let testCount = 0;
        let passedCount = 0;
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = message;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }
        
        function clearOutput() {
            document.getElementById('output').innerHTML = '';
            testCount = 0;
            passedCount = 0;
        }
        
        function runSimpleTest() {
            clearOutput();
            log('<b>Ø´Ø±ÙˆØ¹ ØªØ³Øª Ø³Ø§Ø¯Ù‡:</b>', 'info');
            
            try {
                // ØªØ³Øª Û±: Ø³Ø§Ø®Øª EventBus
                const bus = new HyperEventBus();
                log('âœ… Û±. EventBus Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯', 'success');
                passedCount++;
                
                // ØªØ³Øª Û²: Ø«Ø¨Øª Listener
                let testResult = '';
                bus.on('test:event', (data) => {
                    testResult = data.message;
                });
                log('âœ… Û². Listener Ø«Ø¨Øª Ø´Ø¯', 'success');
                passedCount++;
                
                // ØªØ³Øª Û³: Ø§Ø±Ø³Ø§Ù„ Event
                bus.emit('test:event', { message: 'Ø³Ù„Ø§Ù… Ø¯Ù†ÛŒØ§!' });
                if (testResult === 'Ø³Ù„Ø§Ù… Ø¯Ù†ÛŒØ§!') {
                    log('âœ… Û³. Event Ø§Ø±Ø³Ø§Ù„ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯', 'success');
                    passedCount++;
                } else {
                    log('âŒ Û³. Ø¯Ø±ÛŒØ§ÙØª Event Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯', 'error');
                }
                
                // ØªØ³Øª Û´: Once Listener
                let onceCount = 0;
                bus.once('test:once', () => onceCount++);
                bus.emit('test:once');
                bus.emit('test:once');
                if (onceCount === 1) {
                    log('âœ… Û´. Once Listener Ú©Ø§Ø± Ú©Ø±Ø¯', 'success');
                    passedCount++;
                } else {
                    log('âŒ Û´. Once Listener Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯', 'error');
                }
                
                // Ù†ØªØ§ÛŒØ¬
                log(`<br><b>Ù†ØªØ§ÛŒØ¬: ${passedCount} Ø§Ø² Û´ ØªØ³Øª Ù…ÙˆÙÙ‚</b>`, 
                    passedCount === 4 ? 'success' : 'error');
                    
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§: ${error.message}`, 'error');
            }
        }
        
        function runAllTests() {
            clearOutput();
            log('<b>Ø´Ø±ÙˆØ¹ ØªØ³Øª Ú©Ø§Ù…Ù„ EventBus:</b>', 'info');
            
            const tests = [
                {
                    name: 'Ø³Ø§Ø®Øª EventBus',
                    run: () => new HyperEventBus()
                },
                {
                    name: 'Ø«Ø¨Øª Ùˆ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Listener',
                    run: () => {
                        const bus = new HyperEventBus();
                        let called = false;
                        bus.on('test', () => called = true);
                        bus.emit('test');
                        return called;
                    }
                },
                {
                    name: 'Once Listener',
                    run: () => {
                        const bus = new HyperEventBus();
                        let count = 0;
                        bus.once('once-test', () => count++);
                        bus.emit('once-test');
                        bus.emit('once-test');
                        return count === 1;
                    }
                },
                {
                    name: 'Priority',
                    run: () => {
                        const bus = new HyperEventBus();
                        const order = [];
                        bus.on('priority', () => order.push('low'), { priority: 1 });
                        bus.on('priority', () => order.push('high'), { priority: 10 });
                        bus.emit('priority');
                        return order[0] === 'high';
                    }
                },
                {
                    name: 'Wildcard (*)',
                    run: () => {
                        const bus = new HyperEventBus({ enableWildcards: true });
                        let received = false;
                        bus.on('app:*', () => received = true);
                        bus.emit('app:user:login');
                        return received;
                    }
                },
                {
                    name: 'Ø­Ø°Ù Listener',
                    run: () => {
                        const bus = new HyperEventBus();
                        let count = 0;
                        const listener = () => count++;
                        bus.on('remove-test', listener);
                        bus.emit('remove-test'); // Ø¨Ø§ÛŒØ¯ Ø¨Ø´Ù…Ø§Ø±Ø¯
                        bus.off('remove-test', listener);
                        bus.emit('remove-test'); // Ù†Ø¨Ø§ÛŒØ¯ Ø¨Ø´Ù…Ø§Ø±Ø¯
                        return count === 1;
                    }
                },
                {
                    name: 'Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§',
                    run: () => {
                        const bus = new HyperEventBus();
                        bus.on('metric1', () => {});
                        bus.on('metric2', () => {});
                        bus.emit('metric1');
                        bus.emit('metric2');
                        const metrics = bus.getMetrics();
                        return metrics.emissions === 2 && metrics.deliveries === 2;
                    }
                }
            ];
            
            let passed = 0;
            
            tests.forEach((test, index) => {
                try {
                    const result = test.run();
                    if (result) {
                        log(`âœ… ${index + 1}. ${test.name}`, 'success');
                        passed++;
                    } else {
                        log(`âŒ ${index + 1}. ${test.name}`, 'error');
                    }
                } catch (error) {
                    log(`âŒ ${index + 1}. ${test.name} - Ø®Ø·Ø§: ${error.message}`, 'error');
                }
            });
            
            log(`<br><b>ğŸ¯ Ù†ØªØ§ÛŒØ¬ Ù†Ù‡Ø§ÛŒÛŒ: ${passed} Ø§Ø² ${tests.length} ØªØ³Øª Ù…ÙˆÙÙ‚</b>`, 
                passed === tests.length ? 'success' : passed > tests.length/2 ? 'info' : 'error');
        }
        
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        log('âœ… EventBus Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª Ø§Ø³Øª', 'success');
        log('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯', 'info');
    </script>
</body>
</html>
