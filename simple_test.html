<!DOCTYPE html>
<html dir="rtl">
<head>
    <title>ØªØ³Øª EventBus - Vakamova</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .test-area {
            padding: 25px;
        }
        
        .status {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            animation: fadeIn 0.5s;
        }
        
        .status.loading {
            background: #e0f2fe;
            color: #0369a1;
            border: 2px solid #38bdf8;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .btn {
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(90deg, #10b981, #34d399);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #ef4444, #f87171);
            color: white;
        }
        
        .output {
            background: #0f172a;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.8;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
        }
        
        .output .success {
            color: #34d399;
        }
        
        .output .error {
            color: #f87171;
        }
        
        .output .info {
            color: #60a5fa;
        }
        
        .output .test-title {
            color: #c084fc;
            font-weight: bold;
            margin-top: 15px;
            display: block;
        }
        
        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
        }
        
        .result-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .result-card h3 {
            color: #475569;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        .result-card .value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .passed .value {
            color: #10b981;
        }
        
        .failed .value {
            color: #ef4444;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #64748b;
            font-size: 0.9rem;
            border-top: 1px solid #e2e8f0;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 10px;
            }
            
            header {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .test-area {
                padding: 20px;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§ª ØªØ³Øª HyperEventBus</h1>
            <p class="subtitle">Ù¾Ø±ÙˆÚ˜Ù‡ Vakamova - Ø³ÛŒØ³ØªÙ… EventBus Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± SOLID</p>
        </header>
        
        <div class="test-area">
            <div class="status loading" id="status">
                Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ EventBus...
            </div>
            
            <div class="controls">
                <button class="btn btn-primary" onclick="runTest('basic')">
                    <span>ğŸ¯</span> ØªØ³Øª Ù¾Ø§ÛŒÙ‡
                </button>
                <button class="btn btn-success" onclick="runTest('listeners')">
                    <span>ğŸ‘‚</span> ØªØ³Øª Listeners
                </button>
                <button class="btn btn-warning" onclick="runTest('once')">
                    <span>1ï¸âƒ£</span> ØªØ³Øª Once
                </button>
                <button class="btn btn-danger" onclick="runTest('all')">
                    <span>ğŸš€</span> ØªØ³Øª Ú©Ø§Ù…Ù„
                </button>
                <button class="btn" onclick="clearOutput()" style="background: #94a3b8; color: white;">
                    <span>ğŸ—‘ï¸</span> Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
                </button>
            </div>
            
            <div class="output" id="output">
                <!-- Ù†ØªØ§ÛŒØ¬ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </div>
            
            <div class="results-summary" id="resultsSummary" style="display: none;">
                <div class="result-card passed">
                    <h3>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚</h3>
                    <div class="value" id="passedCount">0</div>
                    <p>ØªØ³Øª passed</p>
                </div>
                <div class="result-card failed">
                    <h3>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯Ù‡</h3>
                    <div class="value" id="failedCount">0</div>
                    <p>ØªØ³Øª failed</p>
                </div>
                <div class="result-card">
                    <h3>Ù¾ÙˆØ´Ø´ ØªØ³Øª</h3>
                    <div class="value" id="coveragePercent">0%</div>
                    <p>Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Ù¾Ø±ÙˆÚ˜Ù‡ Vakamova - Ø³ÛŒØ³ØªÙ… EventBus Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ | Ù†Ø³Ø®Ù‡ Û±.Û°.Û°</p>
            <p>ØªÙˆØ³Ø¹Ù‡â€ŒÛŒØ§ÙØªÙ‡ Ø¨Ø§ Ø§ØµÙˆÙ„ SOLID Ùˆ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù„Ø§ÛŒÙ‡â€ŒØ§ÛŒ</p>
        </footer>
    </div>

    <!-- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ EventBus -->
    <script src="event_bus.js"></script>
    
    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ ØªØ³Øª
        let passedTests = 0;
        let failedTests = 0;
        let totalTests = 0;
        
        // Ø§Ù„Ù…Ù†Øªâ€ŒÙ‡Ø§ÛŒ DOM
        const statusEl = document.getElementById('status');
        const outputEl = document.getElementById('output');
        const resultsSummary = document.getElementById('resultsSummary');
        
        // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = message;
            outputEl.appendChild(div);
            outputEl.scrollTop = outputEl.scrollHeight;
        }
        
        // ØªØ§Ø¨Ø¹ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø®Ø±ÙˆØ¬ÛŒ
        function clearOutput() {
            outputEl.innerHTML = '';
            passedTests = 0;
            failedTests = 0;
            totalTests = 0;
            updateResults();
        }
        
        // ØªØ§Ø¨Ø¹ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†ØªØ§ÛŒØ¬
        function updateResults() {
            document.getElementById('passedCount').textContent = passedTests;
            document.getElementById('failedCount').textContent = failedTests;
            
            totalTests = passedTests + failedTests;
            const coverage = totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0;
            document.getElementById('coveragePercent').textContent = `${coverage}%`;
            
            if (totalTests > 0) {
                resultsSummary.style.display = 'grid';
            }
        }
        
        // ØªØ§Ø¨Ø¹ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª
        function runTest(testType) {
            // Ø§Ø¨ØªØ¯Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù† EventBus Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡
            if (typeof HyperEventBus === 'undefined') {
                log('âŒ Ø®Ø·Ø§: HyperEventBus Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!', 'error');
                log('Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ event_bus.js Ø¯Ø± Ù…Ø³ÛŒØ± Ø¯Ø±Ø³Øª Ø§Ø³Øª.', 'info');
                return;
            }
            
            log(`\nğŸ“‹ Ø´Ø±ÙˆØ¹ ØªØ³Øª: ${getTestName(testType)}`, 'test-title');
            
            try {
                // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÙˆÙ†Ù‡ EventBus
                const bus = new HyperEventBus();
                log('âœ… Ù†Ù…ÙˆÙ†Ù‡ EventBus Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯', 'success');
                passedTests++;
                
                // ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
                if (testType === 'basic' || testType === 'all') {
                    testBasic(bus);
                }
                
                if (testType === 'listeners' || testType === 'all') {
                    testListeners(bus);
                }
                
                if (testType === 'once' || testType === 'all') {
                    testOnce(bus);
                }
                
                if (testType === 'all') {
                    testAdvanced(bus);
                }
                
                log(`\nğŸ‰ ØªØ³Øª "${getTestName(testType)}" Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯`, 'success');
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª: ${error.message}`, 'error');
                failedTests++;
                console.error(error);
            }
            
            updateResults();
        }
        
        // ØªØ³Øª Ù¾Ø§ÛŒÙ‡
        function testBasic(bus) {
            log('\nğŸ”¹ ØªØ³Øª Ù¾Ø§ÛŒÙ‡:', 'info');
            
            let receivedData = null;
            
            // Ø«Ø¨Øª Listener
            bus.on('test:basic', (data) => {
                receivedData = data;
                log('  ğŸ“¨ Listener ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø´Ø¯', 'success');
            });
            
            // Ø§Ø±Ø³Ø§Ù„ Event
            const result = bus.emit('test:basic', { 
                message: 'Ø³Ù„Ø§Ù… Vakamova!',
                project: 'Ø§Ù¾ Ø¢Ù…ÙˆØ²Ø´ Ø²Ø¨Ø§Ù†'
            });
            
            // Ø¨Ø±Ø±Ø³ÛŒ
            if (receivedData && receivedData.message === 'Ø³Ù„Ø§Ù… Vakamova!') {
                log('  âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù†Ø¯', 'success');
                passedTests++;
            } else {
                log('  âŒ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯', 'error');
                failedTests++;
            }
            
            if (result.listenersTriggered === 1) {
                log('  âœ… ØªØ¹Ø¯Ø§Ø¯ Listeners Ø¯Ø±Ø³Øª Ø§Ø³Øª', 'success');
                passedTests++;
            } else {
                log('  âŒ ØªØ¹Ø¯Ø§Ø¯ Listeners Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª', 'error');
                failedTests++;
            }
        }
        
        // ØªØ³Øª Multiple Listeners
        function testListeners(bus) {
            log('\nğŸ”¹ ØªØ³Øª Multiple Listeners:', 'info');
            
            let count = 0;
            
            // Ø«Ø¨Øª Ú†Ù†Ø¯ Listener
            bus.on('test:multi', () => {
                count++;
                log(`  ğŸ‘‚ Listener ${count} ÙØ¹Ø§Ù„`, 'info');
            });
            
            bus.on('test:multi', () => {
                count++;
                log(`  ğŸ‘‚ Listener ${count} ÙØ¹Ø§Ù„`, 'info');
            });
            
            bus.on('test:multi', () => {
                count++;
                log(`  ğŸ‘‚ Listener ${count} ÙØ¹Ø§Ù„`, 'info');
            });
            
            // Ø§Ø±Ø³Ø§Ù„ Event
            bus.emit('test:multi');
            
            // Ø¨Ø±Ø±Ø³ÛŒ
            if (count === 3) {
                log('  âœ… ØªÙ…Ø§Ù… Listeners ÙØ¹Ø§Ù„ Ø´Ø¯Ù†Ø¯', 'success');
                passedTests++;
            } else {
                log(`  âŒ ÙÙ‚Ø· ${count} Ø§Ø² 3 Listener ÙØ¹Ø§Ù„ Ø´Ø¯`, 'error');
                failedTests++;
            }
        }
        
        // ØªØ³Øª Once Listener
        function testOnce(bus) {
            log('\nğŸ”¹ ØªØ³Øª Once Listener:', 'info');
            
            let onceCount = 0;
            
            // Ø«Ø¨Øª Once Listener
            bus.once('test:once', () => {
                onceCount++;
                log('  ğŸ”‚ Once Listener ÙØ¹Ø§Ù„ Ø´Ø¯', 'success');
            });
            
            // Ú†Ù†Ø¯ Ø¨Ø§Ø± Ø§Ø±Ø³Ø§Ù„
            bus.emit('test:once');
            bus.emit('test:once');
            bus.emit('test:once');
            
            // Ø¨Ø±Ø±Ø³ÛŒ
            if (onceCount === 1) {
                log('  âœ… Once Listener ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø± ÙØ¹Ø§Ù„ Ø´Ø¯', 'success');
                passedTests++;
            } else {
                log(`  âŒ Once Listener ${onceCount} Ø¨Ø§Ø± ÙØ¹Ø§Ù„ Ø´Ø¯`, 'error');
                failedTests++;
            }
        }
        
        // ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡
        function testAdvanced(bus) {
            log('\nğŸ”¹ ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡:', 'info');
            
            // ØªØ³Øª clear
            bus.on('test:clear', () => {});
            bus.clear('test:clear');
            
            if (bus.getListenerCount('test:clear') === 0) {
                log('  âœ… clear() Ú©Ø§Ø± Ú©Ø±Ø¯', 'success');
                passedTests++;
            }
            
            // ØªØ³Øª getMetrics
            const metrics = bus.getMetrics();
            if (metrics && typeof metrics.emissions === 'number') {
                log('  âœ… Ù…ØªØ±ÛŒÚ©â€ŒÙ‡Ø§ Ø¯Ø±Ø³Øª Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯', 'success');
                passedTests++;
            }
            
            // ØªØ³Øª Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Vakamova
            log('\nğŸ“ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø¢Ù…ÙˆØ²Ø´ Ø²Ø¨Ø§Ù†:', 'info');
            
            let lessonStarted = false;
            let exerciseCompleted = false;
            let progressUpdated = false;
            
            bus.on('lesson:started', () => {
                lessonStarted = true;
                log('  ğŸ“– Ø¯Ø±Ø³ Ø´Ø±ÙˆØ¹ Ø´Ø¯', 'info');
            });
            
            bus.on('exercise:completed', (data) => {
                exerciseCompleted = true;
                log(`  âœ… ØªÙ…Ø±ÛŒÙ† Ú©Ø§Ù…Ù„ Ø´Ø¯: ${data.score}%`, 'info');
            });
            
            bus.on('user:progress:updated', (data) => {
                progressUpdated = true;
                log(`  ğŸ“Š Ù¾ÛŒØ´Ø±ÙØª Ú©Ø§Ø±Ø¨Ø±: Ø³Ø·Ø­ ${data.level}`, 'info');
            });
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú¯Ø±Ø¯Ø´ Ú©Ø§Ø±
            bus.emit('lesson:started');
            bus.emit('exercise:completed', { score: 95, time: 120 });
            bus.emit('user:progress:updated', { level: 3, points: 150 });
            
            if (lessonStarted && exerciseCompleted && progressUpdated) {
                log('  ğŸ¯ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¬Ø±Ø§ Ø´Ø¯', 'success');
                passedTests++;
            }
        }
        
        // Ù†Ø§Ù… ØªØ³Øª
        function getTestName(type) {
            const names = {
                'basic': 'Ù¾Ø§ÛŒÙ‡',
                'listeners': 'Multiple Listeners',
                'once': 'Once Listener',
                'all': 'Ú©Ø§Ù…Ù„'
            };
            return names[type] || type;
        }
        
        // ÙˆÙ‚ØªÛŒ ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯
        window.onload = function() {
            setTimeout(() => {
                if (typeof HyperEventBus === 'undefined') {
                    statusEl.textContent = 'âŒ HyperEventBus Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯!';
                    statusEl.className = 'status error';
                    log('ÙØ§ÛŒÙ„ event_bus.js Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯:', 'error');
                    log('1. Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ ÙØ§ÛŒÙ„ Ø¯Ø± Ù…Ø³ÛŒØ± Ø¯Ø±Ø³Øª Ø§Ø³Øª', 'info');
                    log('2. Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ ÙØ§ÛŒÙ„ Ø®Ø·Ø§ÛŒ syntax Ù†Ø¯Ø§Ø±Ø¯', 'info');
                } else {
                    statusEl.textContent = 'âœ… HyperEventBus Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª Ø§Ø³Øª!';
                    statusEl.className = 'status success';
                    log('ğŸ‰ EventBus Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯', 'success');
                    log('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯', 'info');
                }
            }, 500);
        };
    </script>
</body>
</html>
